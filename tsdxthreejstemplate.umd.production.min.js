!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three"),require("react")):"function"==typeof define&&define.amd?define(["exports","three","react"],t):t((e=e||self).TsdxThreejsTemplate={},e.THREE,e.React)}(this,(function(e,t,n){"use strict";function r(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var a=e.apply(t,n);function s(e){r(a,o,i,s,c,"next",e)}function c(e){r(a,o,i,s,c,"throw",e)}s(void 0)}))}}function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function a(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;var s=function(e,t){return function(e){var t=function(e){var t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var o=Object.create((t&&t.prototype instanceof h?t:h).prototype),i=new x(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=b(a,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=u(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,i),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function h(){}function p(){}function f(){}var d={};d[o]=function(){return this};var m=Object.getPrototypeOf,g=m&&m(m(T([])));g&&g!==t&&n.call(g,o)&&(d=g);var v=f.prototype=h.prototype=Object.create(d);function y(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){var r;this._invoke=function(o,i){function a(){return new t((function(r,a){!function r(o,i,a,s){var c=u(e[o],e,i);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==typeof h&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(h).then((function(e){l.value=e,a(l)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var o=r.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function T(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return p.prototype=v.constructor=f,f.constructor=p,p.displayName=s(f,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,a,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},y(w.prototype),w.prototype[i]=function(){return this},e.AsyncIterator=w,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new w(c(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(v),s(v,a,"Generator"),v[o]=function(){return this},v.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=T,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),_(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;_(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:T(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}(t={exports:{}}),t.exports}();const c={type:"change"},u={type:"start"},l={type:"end"};class h extends t.EventDispatcher{constructor(e,n){super(),void 0===n&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),n===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=n,this.enabled=!0,this.target=new t.Vector3,this.minDistance=0,this.maxDistance=Infinity,this.minZoom=0,this.maxZoom=Infinity,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-Infinity,this.maxAzimuthAngle=Infinity,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:t.MOUSE.ROTATE,MIDDLE:t.MOUSE.DOLLY,RIGHT:t.MOUSE.PAN},this.touches={ONE:t.TOUCH.ROTATE,TWO:t.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return s.phi},this.getAzimuthalAngle=function(){return s.theta},this.listenToKeyEvents=function(e){e.addEventListener("keydown",H),this._domElementKeyEvents=e},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(c),r.update(),i=o.NONE},this.update=function(){const n=new t.Vector3,u=(new t.Quaternion).setFromUnitVectors(e.up,new t.Vector3(0,1,0)),l=u.clone().invert(),m=new t.Vector3,g=new t.Quaternion,v=2*Math.PI;return function(){const e=r.object.position;n.copy(e).sub(r.target),n.applyQuaternion(u),s.setFromVector3(n),r.autoRotate&&i===o.NONE&&k(2*Math.PI/60/60*r.autoRotateSpeed),r.enableDamping?(s.theta+=h.theta*r.dampingFactor,s.phi+=h.phi*r.dampingFactor):(s.theta+=h.theta,s.phi+=h.phi);let t=r.minAzimuthAngle,y=r.maxAzimuthAngle;return isFinite(t)&&isFinite(y)&&(t<-Math.PI?t+=v:t>Math.PI&&(t-=v),y<-Math.PI?y+=v:y>Math.PI&&(y-=v),s.theta=t<=y?Math.max(t,Math.min(y,s.theta)):s.theta>(t+y)/2?Math.max(t,s.theta):Math.min(y,s.theta)),s.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,s.phi)),s.makeSafe(),s.radius*=p,s.radius=Math.max(r.minDistance,Math.min(r.maxDistance,s.radius)),!0===r.enableDamping?r.target.addScaledVector(f,r.dampingFactor):r.target.add(f),n.setFromSpherical(s),n.applyQuaternion(l),e.copy(r.target).add(n),r.object.lookAt(r.target),!0===r.enableDamping?(h.theta*=1-r.dampingFactor,h.phi*=1-r.dampingFactor,f.multiplyScalar(1-r.dampingFactor)):(h.set(0,0,0),f.set(0,0,0)),p=1,!!(d||m.distanceToSquared(r.object.position)>a||8*(1-g.dot(r.object.quaternion))>a)&&(r.dispatchEvent(c),m.copy(r.object.position),g.copy(r.object.quaternion),d=!1,!0)}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",Z),r.domElement.removeEventListener("pointerdown",z),r.domElement.removeEventListener("wheel",G),r.domElement.removeEventListener("touchstart",X),r.domElement.removeEventListener("touchend",W),r.domElement.removeEventListener("touchmove",Y),r.domElement.ownerDocument.removeEventListener("pointermove",B),r.domElement.ownerDocument.removeEventListener("pointerup",U),null!==r._domElementKeyEvents&&r._domElementKeyEvents.removeEventListener("keydown",H)};const r=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let i=o.NONE;const a=1e-6,s=new t.Spherical,h=new t.Spherical;let p=1;const f=new t.Vector3;let d=!1;const m=new t.Vector2,g=new t.Vector2,v=new t.Vector2,y=new t.Vector2,w=new t.Vector2,b=new t.Vector2,E=new t.Vector2,_=new t.Vector2,x=new t.Vector2;function T(){return Math.pow(.95,r.zoomSpeed)}function k(e){h.theta-=e}function L(e){h.phi-=e}const I=function(){const e=new t.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),f.add(e)}}(),M=function(){const e=new t.Vector3;return function(t,n){!0===r.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(r.object.up,e)),e.multiplyScalar(t),f.add(e)}}(),A=function(){const e=new t.Vector3;return function(t,n){const o=r.domElement;if(r.object.isPerspectiveCamera){e.copy(r.object.position).sub(r.target);let i=e.length();i*=Math.tan(r.object.fov/2*Math.PI/180),I(2*t*i/o.clientHeight,r.object.matrix),M(2*n*i/o.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(I(t*(r.object.right-r.object.left)/r.object.zoom/o.clientWidth,r.object.matrix),M(n*(r.object.top-r.object.bottom)/r.object.zoom/o.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function P(e){r.object.isPerspectiveCamera?p/=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*e)),r.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function D(e){r.object.isPerspectiveCamera?p*=e:r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/e)),r.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function O(e){m.set(e.clientX,e.clientY)}function S(e){y.set(e.clientX,e.clientY)}function C(e){1==e.touches.length?m.set(e.touches[0].pageX,e.touches[0].pageY):m.set(.5*(e.touches[0].pageX+e.touches[1].pageX),.5*(e.touches[0].pageY+e.touches[1].pageY))}function R(e){1==e.touches.length?y.set(e.touches[0].pageX,e.touches[0].pageY):y.set(.5*(e.touches[0].pageX+e.touches[1].pageX),.5*(e.touches[0].pageY+e.touches[1].pageY))}function j(e){const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);E.set(0,r)}function N(e){1==e.touches.length?g.set(e.touches[0].pageX,e.touches[0].pageY):g.set(.5*(e.touches[0].pageX+e.touches[1].pageX),.5*(e.touches[0].pageY+e.touches[1].pageY)),v.subVectors(g,m).multiplyScalar(r.rotateSpeed);const t=r.domElement;k(2*Math.PI*v.x/t.clientHeight),L(2*Math.PI*v.y/t.clientHeight),m.copy(g)}function F(e){1==e.touches.length?w.set(e.touches[0].pageX,e.touches[0].pageY):w.set(.5*(e.touches[0].pageX+e.touches[1].pageX),.5*(e.touches[0].pageY+e.touches[1].pageY)),b.subVectors(w,y).multiplyScalar(r.panSpeed),A(b.x,b.y),y.copy(w)}function V(e){const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);_.set(0,o),x.set(0,Math.pow(_.y/E.y,r.zoomSpeed)),P(x.y),E.copy(_)}function z(e){if(!1!==r.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){let n;switch(e.preventDefault(),r.domElement.focus?r.domElement.focus():window.focus(),e.button){case 0:n=r.mouseButtons.LEFT;break;case 1:n=r.mouseButtons.MIDDLE;break;case 2:n=r.mouseButtons.RIGHT;break;default:n=-1}switch(n){case t.MOUSE.DOLLY:if(!1===r.enableZoom)return;!function(e){E.set(e.clientX,e.clientY)}(e),i=o.DOLLY;break;case t.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;S(e),i=o.PAN}else{if(!1===r.enableRotate)return;O(e),i=o.ROTATE}break;case t.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;O(e),i=o.ROTATE}else{if(!1===r.enablePan)return;S(e),i=o.PAN}break;default:i=o.NONE}i!==o.NONE&&(r.domElement.ownerDocument.addEventListener("pointermove",B),r.domElement.ownerDocument.addEventListener("pointerup",U),r.dispatchEvent(u))}(e)}}function B(e){if(!1!==r.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1!==r.enabled)switch(e.preventDefault(),i){case o.ROTATE:if(!1===r.enableRotate)return;!function(e){g.set(e.clientX,e.clientY),v.subVectors(g,m).multiplyScalar(r.rotateSpeed);const t=r.domElement;k(2*Math.PI*v.x/t.clientHeight),L(2*Math.PI*v.y/t.clientHeight),m.copy(g),r.update()}(e);break;case o.DOLLY:if(!1===r.enableZoom)return;!function(e){_.set(e.clientX,e.clientY),x.subVectors(_,E),x.y>0?P(T()):x.y<0&&D(T()),E.copy(_),r.update()}(e);break;case o.PAN:if(!1===r.enablePan)return;!function(e){w.set(e.clientX,e.clientY),b.subVectors(w,y).multiplyScalar(r.panSpeed),A(b.x,b.y),y.copy(w),r.update()}(e)}}(e)}}function U(e){switch(e.pointerType){case"mouse":case"pen":r.domElement.ownerDocument.removeEventListener("pointermove",B),r.domElement.ownerDocument.removeEventListener("pointerup",U),!1!==r.enabled&&(r.dispatchEvent(l),i=o.NONE)}}function G(e){!1===r.enabled||!1===r.enableZoom||i!==o.NONE&&i!==o.ROTATE||(e.preventDefault(),r.dispatchEvent(u),function(e){e.deltaY<0?D(T()):e.deltaY>0&&P(T()),r.update()}(e),r.dispatchEvent(l))}function H(e){!1!==r.enabled&&!1!==r.enablePan&&function(e){let t=!1;switch(e.code){case r.keys.UP:A(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:A(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:A(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:A(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}(e)}function X(e){if(!1!==r.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(r.touches.ONE){case t.TOUCH.ROTATE:if(!1===r.enableRotate)return;C(e),i=o.TOUCH_ROTATE;break;case t.TOUCH.PAN:if(!1===r.enablePan)return;R(e),i=o.TOUCH_PAN;break;default:i=o.NONE}break;case 2:switch(r.touches.TWO){case t.TOUCH.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&j(e),r.enablePan&&R(e)}(e),i=o.TOUCH_DOLLY_PAN;break;case t.TOUCH.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&j(e),r.enableRotate&&C(e)}(e),i=o.TOUCH_DOLLY_ROTATE;break;default:i=o.NONE}break;default:i=o.NONE}i!==o.NONE&&r.dispatchEvent(u)}}function Y(e){if(!1!==r.enabled)switch(e.preventDefault(),i){case o.TOUCH_ROTATE:if(!1===r.enableRotate)return;N(e),r.update();break;case o.TOUCH_PAN:if(!1===r.enablePan)return;F(e),r.update();break;case o.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&V(e),r.enablePan&&F(e)}(e),r.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&V(e),r.enableRotate&&N(e)}(e),r.update();break;default:i=o.NONE}}function W(e){!1!==r.enabled&&(r.dispatchEvent(l),i=o.NONE)}function Z(e){!1!==r.enabled&&e.preventDefault()}r.domElement.addEventListener("contextmenu",Z),r.domElement.addEventListener("pointerdown",z),r.domElement.addEventListener("wheel",G,{passive:!1}),r.domElement.addEventListener("touchstart",X,{passive:!1}),r.domElement.addEventListener("touchend",W),r.domElement.addEventListener("touchmove",Y,{passive:!1}),this.update()}}const p={type:"change"},f={type:"start"},d={type:"end"};class m extends t.EventDispatcher{constructor(e,n){super(),void 0===n&&console.warn('THREE.TrackballControls: The second parameter "domElement" is now mandatory.'),n===document&&console.error('THREE.TrackballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.');const r=this;this.object=e,this.domElement=n,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=Infinity,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:t.MOUSE.ROTATE,MIDDLE:t.MOUSE.DOLLY,RIGHT:t.MOUSE.PAN},this.target=new t.Vector3;const o=new t.Vector3;let i=1,a=-1,s=-1,c=0,u=0,l=0;const h=new t.Vector3,m=new t.Vector2,g=new t.Vector2,v=new t.Vector3,y=new t.Vector2,w=new t.Vector2,b=new t.Vector2,E=new t.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,this.handleResize=function(){const e=r.domElement.getBoundingClientRect(),t=r.domElement.ownerDocument.documentElement;r.screen.left=e.left+window.pageXOffset-t.clientLeft,r.screen.top=e.top+window.pageYOffset-t.clientTop,r.screen.width=e.width,r.screen.height=e.height};const _=function(){const e=new t.Vector2;return function(t,n){return e.set((t-r.screen.left)/r.screen.width,(n-r.screen.top)/r.screen.height),e}}(),x=function(){const e=new t.Vector2;return function(t,n){return e.set((t-.5*r.screen.width-r.screen.left)/(.5*r.screen.width),(r.screen.height+2*(r.screen.top-n))/r.screen.width),e}}();function T(e){if(!1!==r.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(e.preventDefault(),-1===a)switch(e.button){case r.mouseButtons.LEFT:a=0;break;case r.mouseButtons.MIDDLE:a=1;break;case r.mouseButtons.RIGHT:a=2;break;default:a=-1}const t=-1!==s?s:a;0!==t||r.noRotate?1!==t||r.noZoom?2!==t||r.noPan||(b.copy(_(e.pageX,e.pageY)),E.copy(b)):(y.copy(_(e.pageX,e.pageY)),w.copy(y)):(g.copy(x(e.pageX,e.pageY)),m.copy(g)),r.domElement.ownerDocument.addEventListener("pointermove",k),r.domElement.ownerDocument.addEventListener("pointerup",L),r.dispatchEvent(f)}(e)}}function k(e){if(!1!==r.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){if(!1===r.enabled)return;e.preventDefault();const t=-1!==s?s:a;0!==t||r.noRotate?1!==t||r.noZoom?2!==t||r.noPan||E.copy(_(e.pageX,e.pageY)):w.copy(_(e.pageX,e.pageY)):(m.copy(g),g.copy(x(e.pageX,e.pageY)))}(e)}}function L(e){if(!1!==r.enabled)switch(e.pointerType){case"mouse":case"pen":!function(e){!1!==r.enabled&&(e.preventDefault(),a=-1,r.domElement.ownerDocument.removeEventListener("pointermove",k),r.domElement.ownerDocument.removeEventListener("pointerup",L),r.dispatchEvent(d))}(e)}}function I(e){!1!==r.enabled&&(window.removeEventListener("keydown",I),-1===s&&(e.code!==r.keys[0]||r.noRotate?e.code!==r.keys[1]||r.noZoom?e.code!==r.keys[2]||r.noPan||(s=2):s=1:s=0))}function M(){!1!==r.enabled&&(s=-1,window.addEventListener("keydown",I))}function A(e){if(!1!==r.enabled&&!0!==r.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:y.y-=.025*e.deltaY;break;case 1:y.y-=.01*e.deltaY;break;default:y.y-=25e-5*e.deltaY}r.dispatchEvent(f),r.dispatchEvent(d)}}function P(e){if(!1!==r.enabled){switch(e.preventDefault(),e.touches.length){case 1:a=3,g.copy(x(e.touches[0].pageX,e.touches[0].pageY)),m.copy(g);break;default:a=4;const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;u=c=Math.sqrt(t*t+n*n),b.copy(_((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2)),E.copy(b)}r.dispatchEvent(f)}}function D(e){if(!1!==r.enabled)switch(e.preventDefault(),e.touches.length){case 1:m.copy(g),g.copy(x(e.touches[0].pageX,e.touches[0].pageY));break;default:const t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;u=Math.sqrt(t*t+n*n),E.copy(_((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2))}}function O(e){if(!1!==r.enabled){switch(e.touches.length){case 0:a=-1;break;case 1:a=3,g.copy(x(e.touches[0].pageX,e.touches[0].pageY)),m.copy(g)}r.dispatchEvent(d)}}function S(e){!1!==r.enabled&&e.preventDefault()}this.rotateCamera=function(){const e=new t.Vector3,n=new t.Quaternion,o=new t.Vector3,i=new t.Vector3,a=new t.Vector3,s=new t.Vector3;return function(){s.set(g.x-m.x,g.y-m.y,0);let t=s.length();t?(h.copy(r.object.position).sub(r.target),o.copy(h).normalize(),i.copy(r.object.up).normalize(),a.crossVectors(i,o).normalize(),i.setLength(g.y-m.y),a.setLength(g.x-m.x),s.copy(i.add(a)),e.crossVectors(s,h).normalize(),t*=r.rotateSpeed,n.setFromAxisAngle(e,t),h.applyQuaternion(n),r.object.up.applyQuaternion(n),v.copy(e),l=t):!r.staticMoving&&l&&(l*=Math.sqrt(1-r.dynamicDampingFactor),h.copy(r.object.position).sub(r.target),n.setFromAxisAngle(v,l),h.applyQuaternion(n),r.object.up.applyQuaternion(n)),m.copy(g)}}(),this.zoomCamera=function(){let e;4===a?(e=c/u,c=u,r.object.isPerspectiveCamera?h.multiplyScalar(e):r.object.isOrthographicCamera?(r.object.zoom*=e,r.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(e=1+(w.y-y.y)*r.zoomSpeed,1!==e&&e>0&&(r.object.isPerspectiveCamera?h.multiplyScalar(e):r.object.isOrthographicCamera?(r.object.zoom/=e,r.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),r.staticMoving?y.copy(w):y.y+=(w.y-y.y)*this.dynamicDampingFactor)},this.panCamera=function(){const e=new t.Vector2,n=new t.Vector3,o=new t.Vector3;return function(){if(e.copy(E).sub(b),e.lengthSq()){if(r.object.isOrthographicCamera){const t=(r.object.top-r.object.bottom)/r.object.zoom/r.domElement.clientWidth;e.x*=(r.object.right-r.object.left)/r.object.zoom/r.domElement.clientWidth,e.y*=t}e.multiplyScalar(h.length()*r.panSpeed),o.copy(h).cross(r.object.up).setLength(e.x),o.add(n.copy(r.object.up).setLength(e.y)),r.object.position.add(o),r.target.add(o),r.staticMoving?b.copy(E):b.add(e.subVectors(E,b).multiplyScalar(r.dynamicDampingFactor))}}}(),this.checkDistances=function(){r.noZoom&&r.noPan||(h.lengthSq()>r.maxDistance*r.maxDistance&&(r.object.position.addVectors(r.target,h.setLength(r.maxDistance)),y.copy(w)),h.lengthSq()<r.minDistance*r.minDistance&&(r.object.position.addVectors(r.target,h.setLength(r.minDistance)),y.copy(w)))},this.update=function(){h.subVectors(r.object.position,r.target),r.noRotate||r.rotateCamera(),r.noZoom||r.zoomCamera(),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,h),r.object.isPerspectiveCamera?(r.checkDistances(),r.object.lookAt(r.target),o.distanceToSquared(r.object.position)>1e-6&&(r.dispatchEvent(p),o.copy(r.object.position))):r.object.isOrthographicCamera?(r.object.lookAt(r.target),(o.distanceToSquared(r.object.position)>1e-6||i!==r.object.zoom)&&(r.dispatchEvent(p),o.copy(r.object.position),i=r.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){a=-1,s=-1,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),h.subVectors(r.object.position,r.target),r.object.lookAt(r.target),r.dispatchEvent(p),o.copy(r.object.position),i=r.object.zoom},this.dispose=function(){r.domElement.removeEventListener("contextmenu",S),r.domElement.removeEventListener("pointerdown",T),r.domElement.removeEventListener("wheel",A),r.domElement.removeEventListener("touchstart",P),r.domElement.removeEventListener("touchend",O),r.domElement.removeEventListener("touchmove",D),r.domElement.ownerDocument.removeEventListener("pointermove",k),r.domElement.ownerDocument.removeEventListener("pointerup",L),window.removeEventListener("keydown",I),window.removeEventListener("keyup",M)},this.domElement.addEventListener("contextmenu",S),this.domElement.addEventListener("pointerdown",T),this.domElement.addEventListener("wheel",A,{passive:!1}),this.domElement.addEventListener("touchstart",P,{passive:!1}),this.domElement.addEventListener("touchend",O),this.domElement.addEventListener("touchmove",D,{passive:!1}),this.domElement.ownerDocument.addEventListener("pointermove",k),this.domElement.ownerDocument.addEventListener("pointerup",L),window.addEventListener("keydown",I),window.addEventListener("keyup",M),this.handleResize(),this.update()}}function g(e){return console.clear(),"\n\n   ______________________________    . \\  | / .\n  /                            / \\     \\ \\ / /\n |                            | ==========  - -\n  \\____________________________\\_/     / / \\ \\\n  ______________________________      \\  | / | \\\n /                            / \\     \\ \\ / /.   .\n|                            | ==========  - -\n \\____________________________\\_/     / / \\ \\    /\n   ______________________________   / |\\  | /  .\n  /                            / \\     \\ \\ / /\n |                            | ==========  -  - -\n  \\____________________________\\_/     / / \\ \\\n                                     .  / | \\  .\n\n  Are you trying to wreak havoc!?!\n\n  "+e+"\n\n  Idiot.\n\n  "}var v=function(){function e(e,n){var r=this;void 0===n&&(n=!1),this._containerId=e,this._isWorldFlippable=n,this._scene=new t.Scene,this._canvas=document.createElement("canvas"),this._clock=new t.Clock(!1),this._initialViewingVector=new t.Vector3(10,10,10),this._isSceneReady=!1,this._isInit=!1,this._fps=60,this._camera=new t.PerspectiveCamera(60,2,.1,13500),this._sceneEntities=[],this.updateCamera=function(){},this.preInitHook=function(){},this.postInitHook=function(){},this._render=function(){r._fps?setTimeout((function(){r._requestAnimationFrameId=requestAnimationFrame(r._render),r.update()}),1e3/r._fps):(r._requestAnimationFrameId=requestAnimationFrame(r._render),r.update())},this._stopRendering=function(){r._requestAnimationFrameId&&(cancelAnimationFrame(r._requestAnimationFrameId),r._requestAnimationFrameId=void 0)}}var n=e.prototype;return n.init=function(){var e=o(s.mark((function e(){var n,r,i=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isInit){e.next=2;break}return e.abrupt("return");case 2:if(this._isInit=!0,this.preInitHook(),n=document.getElementById(this._containerId)){e.next=7;break}throw new Error("No container found with id: "+this._containerId);case 7:if(this._canvas.style.width="100%",this._canvas.style.height="100%",n.append(this._canvas),r=window.devicePixelRatio?window.devicePixelRatio:1,this._renderer=new t.WebGLRenderer({canvas:this._canvas,antialias:!0,alpha:!0}),this._renderer.setPixelRatio(r),this._renderer.sortObjects=!1,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=t.PCFSoftShadowMap,this._renderer.outputEncoding=t.GammaEncoding,this._camera.position.copy(this._initialViewingVector),this._camera.up=new t.Vector3(0,0,1),this._camera.lookAt(0,0,0),this._orbitControls=this._isWorldFlippable?new m(this._camera,this._renderer.domElement):new h(this._camera,this._renderer.domElement),!(this._orbitControls instanceof h)){e.next=26;break}this._orbitControls.enableDamping=!0,this._orbitControls.dampingFactor=.25,e.next=34;break;case 26:if(!(this._orbitControls instanceof m)){e.next=33;break}this._orbitControls.rotateSpeed=10,this._orbitControls.zoomSpeed=1.2,this._orbitControls.panSpeed=.8,this._orbitControls.keys=["65","83","68"],e.next=34;break;case 33:throw Error("Poor Logic");case 34:if(this._sceneEntities.length){e.next=36;break}throw new Error(g("You have no scene entities!"));case 36:return e.next=38,Promise.all(this._sceneEntities.map(function(){var e=o(s.mark((function e(t){var n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.init();case 2:if((n=e.sent)&&n.children.length){e.next=5;break}throw new Error(g('\n            -----------------------------------------------------------------------------\n            The scene entity "'+t.constructor.name+'" has empty sceneEntityGroup\n            after initialization!!!\n            -----------------------------------------------------------------------------\n            '));case 5:return i._scene.add(n),e.abrupt("return");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 38:this.setHelpersVisibility(!1),this.updateCameraAspect(),this._clock.start(),this._render(),this.postInitHook();case 43:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.addSceneEntities=function(e){var t=this;e.forEach((function(e){return t._sceneEntities.push(e)}))},n.update=function(){var e,t=this._clock?this._clock.getElapsedTime():0;if(this._sceneEntities.forEach((function(e){return e.update(t)})),this.updateCamera(t),null==(e=this._orbitControls)||e.update(),!this._camera||!this._renderer)throw new Error("Poor Logic");this._renderer.render(this._scene,this._camera)},n.setHelpersVisibility=function(e){this._scene.traverse((function(t){return t.userData.isHelper&&(t.visible=e)}))},n.updateCameraAspect=function(){this._canvas.style.width="100%",this._canvas.style.height="100%";var e=this._canvas.offsetWidth||1,t=this._canvas.offsetHeight||1;this._camera.aspect=e/t,this._camera.updateProjectionMatrix(),this._renderer.setSize(e,t)},e}(),y={},w=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},b=function(e){return new Worker(e)};try{URL.revokeObjectURL(w(""))}catch(e){w=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},b=function(e){return new Worker(e,{type:"module"})}}var E=Uint8Array,_=Uint16Array,x=Uint32Array,T=new E([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),k=new E([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),L=new E([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),I=function(e,t){for(var n=new _(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var o=new x(n[30]);for(r=1;r<30;++r)for(var i=n[r];i<n[r+1];++i)o[i]=i-n[r]<<5|r;return[n,o]},M=I(T,2),A=M[0],P=M[1];A[28]=258,P[258]=28;for(var D=I(k,0),O=D[0],S=D[1],C=new _(32768),R=0;R<32768;++R){var j=(43690&R)>>>1|(21845&R)<<1;C[R]=((65280&(j=(61680&(j=(52428&j)>>>2|(13107&j)<<2))>>>4|(3855&j)<<4))>>>8|(255&j)<<8)>>>1}var N=function(e,t,n){for(var r=e.length,o=0,i=new _(t);o<r;++o)++i[e[o]-1];var a,s=new _(t);for(o=0;o<t;++o)s[o]=s[o-1]+i[o-1]<<1;if(n){a=new _(1<<t);var c=15-t;for(o=0;o<r;++o)if(e[o])for(var u=o<<4|e[o],l=t-e[o],h=s[e[o]-1]++<<l,p=h|(1<<l)-1;h<=p;++h)a[C[h]>>>c]=u}else for(a=new _(r),o=0;o<r;++o)e[o]&&(a[o]=C[s[e[o]-1]++]>>>15-e[o]);return a},F=new E(288);for(R=0;R<144;++R)F[R]=8;for(R=144;R<256;++R)F[R]=9;for(R=256;R<280;++R)F[R]=7;for(R=280;R<288;++R)F[R]=8;var V=new E(32);for(R=0;R<32;++R)V[R]=5;var z=N(F,9,0),B=N(F,9,1),U=N(V,5,0),G=N(V,5,1),H=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},X=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},Y=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},W=function(e){return(e/8|0)+(7&e&&1)},Z=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new(e instanceof _?_:e instanceof x?x:E)(n-t);return r.set(e.subarray(t,n)),r},K=function(e,t,n){var r=e.length;if(!r||n&&!n.l&&r<5)return t||new E(0);var o=!t||n,i=!n||n.i;n||(n={}),t||(t=new E(3*r));var a=function(e){var n=t.length;if(e>n){var r=new E(Math.max(2*n,e));r.set(t),t=r}},s=n.f||0,c=n.p||0,u=n.b||0,l=n.l,h=n.d,p=n.m,f=n.n,d=8*r;do{if(!l){n.f=s=X(e,c,1);var m=X(e,c+1,3);if(c+=3,!m){var g=e[(S=W(c)+4)-4]|e[S-3]<<8,v=S+g;if(v>r){if(i)throw"unexpected EOF";break}o&&a(u+g),t.set(e.subarray(S,v),u),n.b=u+=g,n.p=c=8*v;continue}if(1==m)l=B,h=G,p=9,f=5;else{if(2!=m)throw"invalid block type";var y=X(e,c,31)+257,w=X(e,c+10,15)+4,b=y+X(e,c+5,31)+1;c+=14;for(var _=new E(b),x=new E(19),I=0;I<w;++I)x[L[I]]=X(e,c+3*I,7);c+=3*w;var M=H(x),P=(1<<M)-1,D=N(x,M,1);for(I=0;I<b;){var S,C=D[X(e,c,P)];if(c+=15&C,(S=C>>>4)<16)_[I++]=S;else{var R=0,j=0;for(16==S?(j=3+X(e,c,3),c+=2,R=_[I-1]):17==S?(j=3+X(e,c,7),c+=3):18==S&&(j=11+X(e,c,127),c+=7);j--;)_[I++]=R}}var F=_.subarray(0,y),V=_.subarray(y);p=H(F),f=H(V),l=N(F,p,1),h=N(V,f,1)}if(c>d){if(i)throw"unexpected EOF";break}}o&&a(u+131072);for(var z=(1<<p)-1,U=(1<<f)-1,K=c;;K=c){var q=(R=l[Y(e,c)&z])>>>4;if((c+=15&R)>d){if(i)throw"unexpected EOF";break}if(!R)throw"invalid length/literal";if(q<256)t[u++]=q;else{if(256==q){K=c,l=null;break}var Q=q-254;q>264&&(Q=X(e,c,(1<<(ee=T[I=q-257]))-1)+A[I],c+=ee);var $=h[Y(e,c)&U],J=$>>>4;if(!$)throw"invalid distance";if(c+=15&$,V=O[J],J>3){var ee=k[J];V+=Y(e,c)&(1<<ee)-1,c+=ee}if(c>d){if(i)throw"unexpected EOF";break}o&&a(u+131072);for(var te=u+Q;u<te;u+=4)t[u]=t[u-V],t[u+1]=t[u+1-V],t[u+2]=t[u+2-V],t[u+3]=t[u+3-V];u=te}}n.l=l,n.p=K,n.b=u,l&&(s=1,n.m=p,n.d=h,n.n=f)}while(!s);return u==t.length?t:Z(t,0,u)},q=function(e,t,n){var r=t/8|0;e[r]|=n<<=7&t,e[r+1]|=n>>>8},Q=function(e,t,n){var r=t/8|0;e[r]|=n<<=7&t,e[r+1]|=n>>>8,e[r+2]|=n>>>16},$=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var o=n.length,i=n.slice();if(!o)return[ie,0];if(1==o){var a=new E(n[0].s+1);return a[n[0].s]=1,[a,1]}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var s=n[0],c=n[1],u=0,l=1,h=2;for(n[0]={s:-1,f:s.f+c.f,l:s,r:c};l!=o-1;)s=n[n[u].f<n[h].f?u++:h++],c=n[u!=l&&n[u].f<n[h].f?u++:h++],n[l++]={s:-1,f:s.f+c.f,l:s,r:c};var p=i[0].s;for(r=1;r<o;++r)i[r].s>p&&(p=i[r].s);var f=new _(p+1),d=J(n[l-1],f,0);if(d>t){r=0;var m=0,g=d-t,v=1<<g;for(i.sort((function(e,t){return f[t.s]-f[e.s]||e.f-t.f}));r<o;++r){var y=i[r].s;if(!(f[y]>t))break;m+=v-(1<<d-f[y]),f[y]=t}for(m>>>=g;m>0;){var w=i[r].s;f[w]<t?m-=1<<t-f[w]++-1:++r}for(;r>=0&&m;--r){var b=i[r].s;f[b]==t&&(--f[b],++m)}d=t}return[new E(f),d]},J=function(e,t,n){return-1==e.s?Math.max(J(e.l,t,n+1),J(e.r,t,n+1)):t[e.s]=n},ee=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new _(++t),r=0,o=e[0],i=1,a=function(e){n[r++]=e},s=1;s<=t;++s)if(e[s]==o&&s!=t)++i;else{if(!o&&i>2){for(;i>138;i-=138)a(32754);i>2&&(a(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(a(o),--i;i>6;i-=6)a(8304);i>2&&(a(i-3<<5|8208),i=0)}for(;i--;)a(o);i=1,o=e[s]}return[n.subarray(0,r),t]},te=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},ne=function(e,t,n){var r=n.length,o=W(t+2);e[o]=255&r,e[o+1]=r>>>8,e[o+2]=255^e[o],e[o+3]=255^e[o+1];for(var i=0;i<r;++i)e[o+i+4]=n[i];return 8*(o+4+r)},re=function(e,t,n,r,o,i,a,s,c,u,l){q(t,l++,n),++o[256];for(var h=$(o,15),p=h[0],f=h[1],d=$(i,15),m=d[0],g=d[1],v=ee(p),y=v[0],w=v[1],b=ee(m),E=b[0],x=b[1],I=new _(19),M=0;M<y.length;++M)I[31&y[M]]++;for(M=0;M<E.length;++M)I[31&E[M]]++;for(var A=$(I,7),P=A[0],D=A[1],O=19;O>4&&!P[L[O-1]];--O);var S,C,R,j,B=u+5<<3,G=te(o,F)+te(i,V)+a,H=te(o,p)+te(i,m)+a+14+3*O+te(I,P)+(2*I[16]+3*I[17]+7*I[18]);if(B<=G&&B<=H)return ne(t,l,e.subarray(c,c+u));if(q(t,l,1+(H<G)),l+=2,H<G){S=N(p,f,0),C=p,R=N(m,g,0),j=m;var X=N(P,D,0);for(q(t,l,w-257),q(t,l+5,x-1),q(t,l+10,O-4),l+=14,M=0;M<O;++M)q(t,l+3*M,P[L[M]]);l+=3*O;for(var Y=[y,E],W=0;W<2;++W){var Z=Y[W];for(M=0;M<Z.length;++M)q(t,l,X[K=31&Z[M]]),l+=P[K],K>15&&(q(t,l,Z[M]>>>5&127),l+=Z[M]>>>12)}}else S=z,C=F,R=U,j=V;for(M=0;M<s;++M)if(r[M]>255){var K;Q(t,l,S[257+(K=r[M]>>>18&31)]),l+=C[K+257],K>7&&(q(t,l,r[M]>>>23&31),l+=T[K]);var J=31&r[M];Q(t,l,R[J]),l+=j[J],J>3&&(Q(t,l,r[M]>>>5&8191),l+=k[J])}else Q(t,l,S[r[M]]),l+=C[r[M]];return Q(t,l,S[256]),l+C[256]},oe=new x([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),ie=new E(0),ae=function(e,t,n,r,o,i){var a=e.length,s=new E(r+a+5*(1+Math.ceil(a/7e3))+o),c=s.subarray(r,s.length-o),u=0;if(!t||a<8)for(var l=0;l<=a;l+=65535){var h=l+65535;h<a?u=ne(c,u,e.subarray(l,h)):(c[l]=i,u=ne(c,u,e.subarray(l,a)))}else{for(var p=oe[t-1],f=p>>>13,d=8191&p,m=(1<<n)-1,g=new _(32768),v=new _(m+1),y=Math.ceil(n/3),w=2*y,b=function(t){return(e[t]^e[t+1]<<y^e[t+2]<<w)&m},L=new x(25e3),I=new _(288),M=new _(32),A=0,D=0,O=(l=0,0),C=0,R=0;l<a;++l){var j=b(l),N=32767&l,F=v[j];if(g[N]=F,v[j]=N,C<=l){var V=a-l;if((A>7e3||O>24576)&&V>423){u=re(e,c,0,L,I,M,D,O,R,l-R,u),O=A=D=0,R=l;for(var z=0;z<286;++z)I[z]=0;for(z=0;z<30;++z)M[z]=0}var B=2,U=0,G=d,H=N-F&32767;if(V>2&&j==b(l-H))for(var X=Math.min(f,V)-1,Y=Math.min(32767,l),K=Math.min(258,V);H<=Y&&--G&&N!=F;){if(e[l+B]==e[l+B-H]){for(var q=0;q<K&&e[l+q]==e[l+q-H];++q);if(q>B){if(B=q,U=H,q>X)break;var Q=Math.min(H,q-2),$=0;for(z=0;z<Q;++z){var J=l-H+z+32768&32767,ee=J-g[J]+32768&32767;ee>$&&($=ee,F=J)}}}H+=(N=F)-(F=g[N])+32768&32767}if(U){L[O++]=268435456|P[B]<<18|S[U];var te=31&P[B],ae=31&S[U];D+=T[te]+k[ae],++I[257+te],++M[ae],C=l+B,++A}else L[O++]=e[l],++I[e[l]]}}u=re(e,c,i,L,I,M,D,O,R,l-R,u),!i&&7&u&&(u=ne(c,u+1,ie))}return Z(s,0,r+W(u)+o)},se=function(){for(var e=new x(256),t=0;t<256;++t){for(var n=t,r=9;--r;)n=(1&n&&3988292384)^n>>>1;e[t]=n}return e}(),ce=function(){var e=-1;return{p:function(t){for(var n=e,r=0;r<t.length;++r)n=se[255&n^t[r]]^n>>>8;e=n},d:function(){return~e}}},ue=function(){var e=1,t=0;return{p:function(n){for(var r=e,o=t,i=n.length,a=0;a!=i;){for(var s=Math.min(a+2655,i);a<s;++a)o+=r+=n[a];r=(65535&r)+15*(r>>16),o=(65535&o)+15*(o>>16)}e=r,t=o},d:function(){return(255&(e%=65521))<<24|e>>>8<<16|(255&(t%=65521))<<8|t>>>8}}},le=function(e,t,n,r,o){return ae(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,r,!o)},he=function(e,t){var n={};for(var r in e)n[r]=e[r];for(var r in t)n[r]=t[r];return n},pe=function(e,t,n){for(var r=e(),o=e.toString(),i=o.slice(o.indexOf("[")+1,o.lastIndexOf("]")).replace(/ /g,"").split(","),a=0;a<r.length;++a){var s=r[a],c=i[a];if("function"==typeof s){t+=";"+c+"=";var u=s.toString();if(s.prototype)if(-1!=u.indexOf("[native code]")){var l=u.indexOf(" ",8)+1;t+=u.slice(l,u.indexOf("(",l))}else for(var h in t+=u,s.prototype)t+=";"+c+".prototype."+h+"="+s.prototype[h].toString();else t+=u}else n[c]=s}return[t,n]},fe=[],de=function(e,t,n,r){var o;if(!fe[n]){for(var i="",a={},s=e.length-1,c=0;c<s;++c)i=(o=pe(e[c],i,a))[0],a=o[1];fe[n]=pe(e[s],i,a)}var u=he({},fe[n][1]);return function(e,t,n,r,o){var i=b(y[t]||(y[t]=w(e)));return i.onerror=function(e){return o(e.error,null)},i.onmessage=function(e){return o(null,e.data)},i.postMessage(n,r),i}(fe[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",n,u,function(e){var t=[];for(var n in e)(e[n]instanceof E||e[n]instanceof _||e[n]instanceof x)&&t.push((e[n]=new e[n].constructor(e[n])).buffer);return t}(u),r)},me=function(){return[E,_,x,T,k,L,A,O,B,G,C,N,H,X,Y,W,Z,K,He,Ee,_e]},ge=function(){return[E,_,x,T,k,L,P,S,z,F,U,V,C,oe,ie,N,q,Q,$,J,ee,te,ne,re,W,Z,ae,le,ze,Ee]},ve=function(){return[Pe,Se,Ae,ce,se]},ye=function(){return[De,Oe]},we=function(){return[Ce,Ae,ue]},be=function(){return[Re]},Ee=function(e){return postMessage(e,[e.buffer])},_e=function(e){return e&&e.size&&new E(e.size)},xe=function(e,t,n,r,o,i){var a=de(n,r,o,(function(e,t){a.terminate(),i(e,t)}));return a.postMessage([e,t],t.consume?[e.buffer]:[]),function(){a.terminate()}},Te=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},ke=function(e,t,n,r,o){var i,a=de(e,r,o,(function(e,n){e?(a.terminate(),t.ondata.call(t,e)):(n[1]&&a.terminate(),t.ondata.call(t,e,n[0],n[1]))}));a.postMessage(n),t.push=function(e,n){if(i)throw"stream finished";if(!t.ondata)throw"no stream handler";a.postMessage([e,i=n],[e.buffer])},t.terminate=function(){a.terminate()}},Le=function(e,t){return e[t]|e[t+1]<<8},Ie=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},Me=function(e,t){return Ie(e,t)+4294967296*Ie(e,t+4)},Ae=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},Pe=function(e,t){var n=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&Ae(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),n){e[3]=8;for(var r=0;r<=n.length;++r)e[r+10]=n.charCodeAt(r)}},De=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],n=10;4&t&&(n+=e[10]|2+(e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(2&t)},Oe=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},Se=function(e){return 10+(e.filename&&e.filename.length+1||0)},Ce=function(e,t){var n=t.level,r=0==n?0:n<6?1:9==n?3:2;e[0]=120,e[1]=r<<6|(r?32-2*r:1)},Re=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function je(e,t){return t||"function"!=typeof e||(t=e,e={}),this.ondata=t,e}var Ne=function(){function e(e,t){t||"function"!=typeof e||(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(le(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),Fe=function(){return function(e,t){ke([ge,function(){return[Te,Ne]}],this,je.call(this,e,t),(function(e){var t=new Ne(e.data);onmessage=Te(t)}),6)}}();function Ve(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return xe(e,t,[ge],(function(e){return Ee(ze(e.data[0],e.data[1]))}),0,n)}function ze(e,t){return le(e,t||{},0,0)}var Be=function(){function e(e){this.s={},this.p=new E(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new E(t+e.length);n.set(this.p),n.set(e,t),this.p=n},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=K(this.p,this.o,this.s);this.ondata(Z(n,t,this.s.b),this.d),this.o=Z(n,this.s.b-32768),this.s.b=this.o.length,this.p=Z(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),Ue=function(){return function(e){this.ondata=e,ke([me,function(){return[Te,Be]}],this,0,(function(){var e=new Be;onmessage=Te(e)}),7)}}();function Ge(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return xe(e,t,[me],(function(e){return Ee(He(e.data[0],_e(e.data[1])))}),1,n)}function He(e,t){return K(e,t)}var Xe=function(){function e(e,t){this.c=ce(),this.l=0,this.v=1,Ne.call(this,e,t)}return e.prototype.push=function(e,t){Ne.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=le(e,this.o,this.v&&Se(this.o),t&&8,!t);this.v&&(Pe(n,this.o),this.v=0),t&&(Ae(n,n.length-8,this.c.d()),Ae(n,n.length-4,this.l)),this.ondata(n,t)},e}(),Ye=function(){return function(e,t){ke([ge,ve,function(){return[Te,Ne,Xe]}],this,je.call(this,e,t),(function(e){var t=new Xe(e.data);onmessage=Te(t)}),8)}}();function We(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return xe(e,t,[ge,ve,function(){return[Ze]}],(function(e){return Ee(Ze(e.data[0],e.data[1]))}),2,n)}function Ze(e,t){t||(t={});var n=ce(),r=e.length;n.p(e);var o=le(e,t,Se(t),8),i=o.length;return Pe(o,t),Ae(o,i-8,n.d()),Ae(o,i-4,r),o}var Ke=function(){function e(e){this.v=1,Be.call(this,e)}return e.prototype.push=function(e,t){if(Be.prototype.e.call(this,e),this.v){var n=this.p.length>3?De(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Be.prototype.c.call(this,t)},e}(),qe=function(){return function(e){this.ondata=e,ke([me,ye,function(){return[Te,Be,Ke]}],this,0,(function(){var e=new Ke;onmessage=Te(e)}),9)}}();function Qe(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return xe(e,t,[me,ye,function(){return[$e]}],(function(e){return Ee($e(e.data[0]))}),3,n)}function $e(e,t){return K(e.subarray(De(e),-8),t||new E(Oe(e)))}var Je=function(){function e(e,t){this.c=ue(),this.v=1,Ne.call(this,e,t)}return e.prototype.push=function(e,t){Ne.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var n=le(e,this.o,this.v&&2,t&&4,!t);this.v&&(Ce(n,this.o),this.v=0),t&&Ae(n,n.length-4,this.c.d()),this.ondata(n,t)},e}(),et=function(){return function(e,t){ke([ge,we,function(){return[Te,Ne,Je]}],this,je.call(this,e,t),(function(e){var t=new Je(e.data);onmessage=Te(t)}),10)}}();function tt(e,t){t||(t={});var n=ue();n.p(e);var r=le(e,t,2,4);return Ce(r,t),Ae(r,r.length-4,n.d()),r}var nt=function(){function e(e){this.v=1,Be.call(this,e)}return e.prototype.push=function(e,t){if(Be.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Be.prototype.c.call(this,t)},e}(),rt=function(){return function(e){this.ondata=e,ke([me,be,function(){return[Te,Be,nt]}],this,0,(function(){var e=new nt;onmessage=Te(e)}),11)}}();function ot(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return xe(e,t,[me,be,function(){return[it]}],(function(e){return Ee(it(e.data[0],_e(e.data[1])))}),5,n)}function it(e,t){return K((Re(e),e.subarray(2,-4)),t)}var at=function(){function e(e){this.G=Ke,this.I=Be,this.Z=nt,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new E(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var r=this,o=function(){r.ondata.apply(r,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(o):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(o):new this.Z(o),this.s.push(this.p,t),this.p=null}}},e}(),st=function(){function e(e){this.G=qe,this.I=Ue,this.Z=rt,this.ondata=e}return e.prototype.push=function(e,t){at.prototype.push.call(this,e,t)},e}(),ct=function(e,t,n,r){for(var o in e){var i=e[o],a=t+o;i instanceof E?n[a]=[i,r]:Array.isArray(i)?n[a]=[i[0],he(r,i[1])]:ct(i,a+"/",n,r)}},ut="undefined"!=typeof TextEncoder&&new TextEncoder,lt="undefined"!=typeof TextDecoder&&new TextDecoder,ht=0;try{lt.decode(ie,{stream:!0}),ht=1}catch(e){}var pt=function(e){for(var t="",n=0;;){var r=e[n++],o=(r>127)+(r>223)+(r>239);if(n+o>e.length)return[t,Z(e,n-1)];o?3==o?(r=((15&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t+=String.fromCharCode(55296|r>>10,56320|1023&r)):t+=String.fromCharCode(1&o?(31&r)<<6|63&e[n++]:(15&r)<<12|(63&e[n++])<<6|63&e[n++]):t+=String.fromCharCode(r)}},ft=function(){function e(e){this.ondata=e,ht?this.t=new TextDecoder:this.p=ie}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new E(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var r=pt(n),o=r[0],i=r[1];if(t){if(i.length)throw"invalid utf-8 data";this.p=null}else this.p=i;this.ondata(o,t)}},e}(),dt=function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(mt(e),this.d=t||!1)},e}();function mt(e,t){if(t){for(var n=new E(e.length),r=0;r<e.length;++r)n[r]=e.charCodeAt(r);return n}if(ut)return ut.encode(e);var o=e.length,i=new E(e.length+(e.length>>1)),a=0,s=function(e){i[a++]=e};for(r=0;r<o;++r){if(a+5>i.length){var c=new E(a+8+(o-r<<1));c.set(i),i=c}var u=e.charCodeAt(r);u<128||t?s(u):u<2048?(s(192|u>>6),s(128|63&u)):u>55295&&u<57344?(s(240|(u=65536+(1047552&u)|1023&e.charCodeAt(++r))>>18),s(128|u>>12&63),s(128|u>>6&63),s(128|63&u)):(s(224|u>>12),s(128|u>>6&63),s(128|63&u))}return Z(i,0,a)}function gt(e,t){if(t){for(var n="",r=0;r<e.length;r+=16384)n+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return n}if(lt)return lt.decode(e);var o=pt(e);if(o[1].length)throw"invalid utf-8 data";return o[0]}var vt=function(e){return 1==e?3:e<6?2:9==e?1:0},yt=function(e,t){return t+30+Le(e,t+26)+Le(e,t+28)},wt=function(e,t,n){var r=Le(e,t+28),o=gt(e.subarray(t+46,t+46+r),!(2048&Le(e,t+8))),i=t+46+r,a=Ie(e,t+20),s=n&&4294967295==a?bt(e,i):[a,Ie(e,t+24),Ie(e,t+42)],c=s[0],u=s[1],l=s[2];return[Le(e,t+10),c,u,o,i+Le(e,t+30)+Le(e,t+32),l]},bt=function(e,t){for(;1!=Le(e,t);t+=4+Le(e,t+2));return[Me(e,t+12),Me(e,t+4),Me(e,t+20)]},Et=function(e){var t=0;if(e)for(var n in e){var r=e[n].length;if(r>65535)throw"extra field too long";t+=r+4}return t},_t=function(e,t,n,r,o,i,a,s){var c=r.length,u=n.extra,l=s&&s.length,h=Et(u);Ae(e,t,null!=a?33639248:67324752),t+=4,null!=a&&(e[t++]=20,e[t++]=n.os),e[t]=20,t+=2,e[t++]=n.flag<<1|(null==i&&8),e[t++]=o&&8,e[t++]=255&n.compression,e[t++]=n.compression>>8;var p=new Date(null==n.mtime?Date.now():n.mtime),f=p.getFullYear()-1980;if(f<0||f>119)throw"date not in range 1980-2099";if(Ae(e,t,f<<25|p.getMonth()+1<<21|p.getDate()<<16|p.getHours()<<11|p.getMinutes()<<5|p.getSeconds()>>>1),t+=4,null!=i&&(Ae(e,t,n.crc),Ae(e,t+4,i),Ae(e,t+8,n.size)),Ae(e,t+12,c),Ae(e,t+14,h),t+=16,null!=a&&(Ae(e,t,l),Ae(e,t+6,n.attrs),Ae(e,t+10,a),t+=14),e.set(r,t),t+=c,h)for(var d in u){var m=u[d],g=m.length;Ae(e,t,+d),Ae(e,t+2,g),e.set(m,t+4),t+=4+g}return l&&(e.set(s,t),t+=l),t},xt=function(e,t,n,r,o){Ae(e,t,101010256),Ae(e,t+8,n),Ae(e,t+10,n),Ae(e,t+12,r),Ae(e,t+16,o)},Tt=function(){function e(e){this.filename=e,this.c=ce(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),kt=function(){function e(e,t){var n=this;t||(t={}),Tt.call(this,e),this.d=new Ne(t,(function(e,t){n.ondata(null,e,t)})),this.compression=8,this.flag=vt(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(e){this.ondata(e,null,t)}},e.prototype.push=function(e,t){Tt.prototype.push.call(this,e,t)},e}(),Lt=function(){function e(e,t){var n=this;t||(t={}),Tt.call(this,e),this.d=new Fe(t,(function(e,t,r){n.ondata(e,t,r)})),this.compression=8,this.flag=vt(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){Tt.prototype.push.call(this,e,t)},e}(),It=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var n=mt(e.filename),r=n.length,o=e.comment,i=o&&mt(o),a=r!=e.filename.length||i&&o.length!=i.length,s=r+Et(e.extra)+30;if(r>65535)throw"filename too long";var c=new E(s);_t(c,0,e,n,a);var u=[c],l=function(){for(var e=0,n=u;e<n.length;e++)t.ondata(null,n[e],!1);u=[]},h=this.d;this.d=0;var p=this.u.length,f=he(e,{f:n,u:a,o:i,t:function(){e.terminate&&e.terminate()},r:function(){if(l(),h){var e=t.u[p+1];e?e.r():t.d=1}h=1}}),d=0;e.ondata=function(n,r,o){if(n)t.ondata(n,r,o),t.terminate();else if(d+=r.length,u.push(r),o){var i=new E(16);Ae(i,0,134695760),Ae(i,4,e.crc),Ae(i,8,d),Ae(i,12,e.size),u.push(i),f.c=d,f.b=s+d+16,f.crc=e.crc,f.size=e.size,h&&f.r(),h=1}else h&&l()},this.u.push(f)},e.prototype.end=function(){var e=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,n=0,r=0,o=this.u;r<o.length;r++)n+=46+(c=o[r]).f.length+Et(c.extra)+(c.o?c.o.length:0);for(var i=new E(n+22),a=0,s=this.u;a<s.length;a++){var c;_t(i,e,c=s[a],c.f,c.u,c.c,t,c.o),e+=46+c.f.length+Et(c.extra)+(c.o?c.o.length:0),t+=c.b}xt(i,e,this.u.length,n,t),this.ondata(null,i,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},e}(),Mt=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}(),At=function(){function e(){var e=this;this.i=new Be((function(t,n){e.ondata(null,t,n)}))}return e.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},e.compression=8,e}(),Pt=function(){function e(e,t){var n=this;t<32e4?this.i=new Be((function(e,t){n.ondata(null,e,t)})):(this.i=new Ue((function(e,t,r){n.ondata(e,t,r)})),this.terminate=this.i.terminate)}return e.prototype.push=function(e,t){this.i.terminate&&(e=Z(e,0)),this.i.push(e,t)},e.compression=8,e}(),Dt=function(){function e(e){this.onfile=e,this.k=[],this.o={0:Mt},this.p=ie}return e.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var r=Math.min(this.c,e.length),o=e.subarray(0,r);if(this.c-=r,this.d?this.d.push(o,!this.c):this.k[0].push(o),(e=e.subarray(r)).length)return this.push(e,t)}else{var i=0,a=0,s=void 0,c=void 0;this.p.length?e.length?((c=new E(this.p.length+e.length)).set(this.p),c.set(e,this.p.length)):c=this.p:c=e;for(var u=c.length,l=this.c,h=l&&this.d,p=function(){var e,t=Ie(c,a);if(67324752==t){i=1,s=a,f.d=null,f.c=0;var r=Le(c,a+6),o=Le(c,a+8),h=2048&r,p=8&r,d=Le(c,a+26),m=Le(c,a+28);if(u>a+30+d+m){var g=[];f.k.unshift(g),i=2;var v,y=Ie(c,a+18),w=Ie(c,a+22),b=gt(c.subarray(a+30,a+=30+d),!h);4294967295==y?(e=p?[-2]:bt(c,a),y=e[0],w=e[1]):p&&(y=-1),a+=m,f.c=y;var E={name:b,compression:o,start:function(){if(!E.ondata)throw"no callback";if(y){var e=n.o[o];if(!e)throw"unknown compression type "+o;(v=y<0?new e(b):new e(b,y,w)).ondata=function(e,t,n){E.ondata(e,t,n)};for(var t=0,r=g;t<r.length;t++)v.push(r[t],!1);n.k[0]==g&&n.c?n.d=v:v.push(ie,!0)}else E.ondata(null,ie,!0)},terminate:function(){v&&v.terminate&&v.terminate()}};y>=0&&(E.size=y,E.originalSize=w),f.onfile(E)}return"break"}if(l){if(134695760==t)return s=a+=12+(-2==l&&8),i=3,f.c=0,"break";if(33639248==t)return s=a-=4,i=3,f.c=0,"break"}},f=this;a<u-4&&"break"!==p();++a);if(this.p=ie,l<0){var d=c.subarray(0,i?s-12-(-2==l&&8)-(134695760==Ie(c,s-16)&&4):a);h?h.push(d,!!i):this.k[+(2==i)].push(d)}if(2&i)return this.push(c.subarray(a),t);this.p=c.subarray(a)}if(t){if(this.c)throw"invalid zip file";this.p=null}},e.prototype.register=function(e){this.o[e.compression]=e},e}(),Ot={__proto__:null,Deflate:Ne,AsyncDeflate:Fe,deflate:Ve,deflateSync:ze,Inflate:Be,AsyncInflate:Ue,inflate:Ge,inflateSync:He,Gzip:Xe,AsyncGzip:Ye,gzip:We,gzipSync:Ze,Gunzip:Ke,AsyncGunzip:qe,gunzip:Qe,gunzipSync:$e,Zlib:Je,AsyncZlib:et,zlib:function(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return xe(e,t,[ge,we,function(){return[tt]}],(function(e){return Ee(tt(e.data[0],e.data[1]))}),4,n)},zlibSync:tt,Unzlib:nt,AsyncUnzlib:rt,unzlib:ot,unzlibSync:it,compress:We,AsyncCompress:Ye,compressSync:Ze,Compress:Xe,Decompress:at,AsyncDecompress:st,decompress:function(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return 31==e[0]&&139==e[1]&&8==e[2]?Qe(e,t,n):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?Ge(e,t,n):ot(e,t,n)},decompressSync:function(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?$e(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?He(e,t):it(e,t)},DecodeUTF8:ft,EncodeUTF8:dt,strToU8:mt,strFromU8:gt,ZipPassThrough:Tt,ZipDeflate:kt,AsyncZipDeflate:Lt,Zip:It,zip:function(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";var r={};ct(e,"",r,t);var o=Object.keys(r),i=o.length,a=0,s=0,c=i,u=new Array(i),l=[],h=function(){for(var e=0;e<l.length;++e)l[e]()},p=function(){var e=new E(s+22),t=a,r=s-a;s=0;for(var o=0;o<c;++o){var i=u[o];try{var l=i.c.length;_t(e,s,i,i.f,i.u,l);var h=30+i.f.length+Et(i.extra),p=s+h;e.set(i.c,p),_t(e,a,i,i.f,i.u,l,s,i.m),a+=16+h+(i.m?i.m.length:0),s=p+l}catch(e){return n(e,null)}}xt(e,a,u.length,r,t),n(null,e)};i||p();for(var f=function(e){var t=o[e],c=r[t],f=c[0],d=c[1],m=ce(),g=f.length;m.p(f);var v=mt(t),y=v.length,w=d.comment,b=w&&mt(w),E=b&&b.length,_=Et(d.extra),x=0==d.level?0:8,T=function(r,o){if(r)h(),n(r,null);else{var c=o.length;u[e]=he(d,{size:g,crc:m.d(),c:o,f:v,m:b,u:y!=t.length||b&&w.length!=E,compression:x}),a+=30+y+_+c,s+=76+2*(y+_)+(E||0)+c,--i||p()}};if(y>65535&&T("filename too long",null),x)if(g<16e4)try{T(null,ze(f,d))}catch(e){T(e,null)}else l.push(Ve(f,d,T));else T(null,f)},d=0;d<c;++d)f(d);return h},zipSync:function(e,t){t||(t={});var n={},r=[];ct(e,"",n,t);var o=0,i=0;for(var a in n){var s=n[a],c=s[0],u=s[1],l=0==u.level?0:8,h=(T=mt(a)).length,p=u.comment,f=p&&mt(p),d=f&&f.length,m=Et(u.extra);if(h>65535)throw"filename too long";var g=l?ze(c,u):c,v=g.length,y=ce();y.p(c),r.push(he(u,{size:c.length,crc:y.d(),c:g,f:T,m:f,u:h!=a.length||f&&p.length!=d,o:o,compression:l})),o+=30+h+m+v,i+=76+2*(h+m)+(d||0)+v}for(var w=new E(i+22),b=o,_=i-o,x=0;x<r.length;++x){var T;_t(w,(T=r[x]).o,T,T.f,T.u,T.c.length);var k=30+T.f.length+Et(T.extra);w.set(T.c,T.o+k),_t(w,o,T,T.f,T.u,T.c.length,T.o,T.m),o+=16+k+(T.m?T.m.length:0)}return xt(w,o,r.length,_,b),w},UnzipPassThrough:Mt,UnzipInflate:At,AsyncUnzipInflate:Pt,Unzip:Dt,unzip:function(e,t){if("function"!=typeof t)throw"no callback";for(var n=[],r=function(){for(var e=0;e<n.length;++e)n[e]()},o={},i=e.length-22;101010256!=Ie(e,i);--i)if(!i||e.length-i>65558)return void t("invalid zip file",null);var a=Le(e,i+8);a||t(null,{});var s=a,c=Ie(e,i+16),u=4294967295==c;if(u){if(i=Ie(e,i-12),101075792!=Ie(e,i))return void t("invalid zip file",null);s=a=Ie(e,i+32),c=Ie(e,i+48)}for(var l=function(i){var s=wt(e,c,u),l=s[0],h=s[1],p=s[2],f=s[3],d=s[4],m=yt(e,s[5]);c=d;var g=function(e,n){e?(r(),t(e,null)):(o[f]=n,--a||t(null,o))};if(l)if(8==l){var v=e.subarray(m,m+h);if(h<32e4)try{g(null,He(v,new E(p)))}catch(e){g(e,null)}else n.push(Ge(v,{size:p},g))}else g("unknown compression type "+l,null);else g(null,Z(e,m,m+h))},h=0;h<s;++h)l();return r},unzipSync:function(e){for(var t={},n=e.length-22;101010256!=Ie(e,n);--n)if(!n||e.length-n>65558)throw"invalid zip file";var r=Le(e,n+8);if(!r)return{};var o=Ie(e,n+16),i=4294967295==o;if(i){if(n=Ie(e,n-12),101075792!=Ie(e,n))throw"invalid zip file";r=Ie(e,n+32),o=Ie(e,n+48)}for(var a=0;a<r;++a){var s=wt(e,o,i),c=s[0],u=s[1],l=s[2],h=s[3],p=s[4],f=yt(e,s[5]);if(o=p,c){if(8!=c)throw"unknown compression type "+c;t[h]=He(e.subarray(f,f+u),new E(l))}else t[h]=Z(e,f,f+u)}return t}};class St{static findSpan(e,t,n){const r=n.length-e-1;if(t>=n[r])return r-1;if(t<=n[e])return e;let o=e,i=r,a=Math.floor((o+i)/2);for(;t<n[a]||t>=n[a+1];)t<n[a]?i=a:o=a,a=Math.floor((o+i)/2);return a}static calcBasisFunctions(e,t,n,r){const o=[],i=[],a=[];o[0]=1;for(let s=1;s<=n;++s){i[s]=t-r[e+1-s],a[s]=r[e+s]-t;let n=0;for(let e=0;e<s;++e){const t=a[e+1],r=i[s-e],c=o[e]/(t+r);o[e]=n+t*c,n=r*c}o[s]=n}return o}static calcBSplinePoint(e,n,r,o){const i=this.findSpan(e,o,n),a=this.calcBasisFunctions(i,o,e,n),s=new t.Vector4(0,0,0,0);for(let t=0;t<=e;++t){const n=r[i-e+t],o=a[t],c=n.w*o;s.x+=n.x*c,s.y+=n.y*c,s.z+=n.z*c,s.w+=n.w*o}return s}static calcBasisFunctionDerivatives(e,t,n,r,o){const i=[];for(let e=0;e<=n;++e)i[e]=0;const a=[];for(let e=0;e<=r;++e)a[e]=i.slice(0);const s=[];for(let e=0;e<=n;++e)s[e]=i.slice(0);s[0][0]=1;const c=i.slice(0),u=i.slice(0);for(let r=1;r<=n;++r){c[r]=t-o[e+1-r],u[r]=o[e+r]-t;let n=0;for(let e=0;e<r;++e){const t=u[e+1],o=c[r-e];s[r][e]=t+o;const i=s[e][r-1]/s[r][e];s[e][r]=n+t*i,n=o*i}s[r][r]=n}for(let e=0;e<=n;++e)a[0][e]=s[e][n];for(let e=0;e<=n;++e){let t=0,o=1;const c=[];for(let e=0;e<=n;++e)c[e]=i.slice(0);c[0][0]=1;for(let i=1;i<=r;++i){let r=0;const u=e-i,l=n-i;e>=i&&(c[o][0]=c[t][0]/s[l+1][u],r=c[o][0]*s[u][l]);const h=e-1<=l?i-1:n-e;for(let e=u>=-1?1:-u;e<=h;++e)c[o][e]=(c[t][e]-c[t][e-1])/s[l+1][u+e],r+=c[o][e]*s[u+e][l];e<=l&&(c[o][i]=-c[t][i-1]/s[l+1][e],r+=c[o][i]*s[e][l]),a[i][e]=r;const p=t;t=o,o=p}}let l=n;for(let e=1;e<=r;++e){for(let t=0;t<=n;++t)a[e][t]*=l;l*=n-e}return a}static calcBSplineDerivatives(e,n,r,o,i){const a=i<e?i:e,s=[],c=this.findSpan(e,o,n),u=this.calcBasisFunctionDerivatives(c,o,e,a,n),l=[];for(let e=0;e<r.length;++e){const t=r[e].clone(),n=t.w;t.x*=n,t.y*=n,t.z*=n,l[e]=t}for(let t=0;t<=a;++t){const n=l[c-e].clone().multiplyScalar(u[t][0]);for(let r=1;r<=e;++r)n.add(l[c-e+r].clone().multiplyScalar(u[t][r]));s[t]=n}for(let e=a+1;e<=i+1;++e)s[e]=new t.Vector4(0,0,0);return s}static calcKoverI(e,t){let n=1;for(let t=2;t<=e;++t)n*=t;let r=1;for(let e=2;e<=t;++e)r*=e;for(let n=2;n<=e-t;++n)r*=n;return n/r}static calcRationalCurveDerivatives(e){const n=e.length,r=[],o=[];for(let i=0;i<n;++i){const n=e[i];r[i]=new t.Vector3(n.x,n.y,n.z),o[i]=n.w}const i=[];for(let e=0;e<n;++e){const t=r[e].clone();for(let n=1;n<=e;++n)t.sub(i[e-n].clone().multiplyScalar(this.calcKoverI(e,n)*o[n]));i[e]=t.divideScalar(o[0])}return i}static calcNURBSDerivatives(e,t,n,r,o){const i=this.calcBSplineDerivatives(e,t,n,r,o);return this.calcRationalCurveDerivatives(i)}static calcSurfacePoint(e,n,r,o,i,a,s,c){const u=this.findSpan(e,a,r),l=this.findSpan(n,s,o),h=this.calcBasisFunctions(u,a,e,r),p=this.calcBasisFunctions(l,s,n,o),f=[];for(let r=0;r<=n;++r){f[r]=new t.Vector4(0,0,0,0);for(let t=0;t<=e;++t){const o=i[u-e+t][l-n+r].clone(),a=o.w;o.x*=a,o.y*=a,o.z*=a,f[r].add(o.multiplyScalar(h[t]))}}const d=new t.Vector4(0,0,0,0);for(let e=0;e<=n;++e)d.add(f[e].multiplyScalar(p[e]));d.divideScalar(d.w),c.set(d.x,d.y,d.z)}}class Ct extends t.Curve{constructor(e,n,r,o,i){super(),this.degree=e,this.knots=n,this.controlPoints=[],this.startKnot=o||0,this.endKnot=i||this.knots.length-1;for(let e=0;e<r.length;++e){const n=r[e];this.controlPoints[e]=new t.Vector4(n.x,n.y,n.z,n.w)}}getPoint(e,n=new t.Vector3){const r=n,o=St.calcBSplinePoint(this.degree,this.knots,this.controlPoints,this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]));return 1!==o.w&&o.divideScalar(o.w),r.set(o.x,o.y,o.z)}getTangent(e,n=new t.Vector3){const r=n,o=St.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),1);return r.copy(o[1]).normalize(),r}}let Rt,jt,Nt;class Ft extends t.Loader{constructor(e){super(e)}load(e,n,r,o){const i=this,a=""===i.path?t.LoaderUtils.extractUrlBase(e):i.path,s=new t.FileLoader(this.manager);s.setPath(i.path),s.setResponseType("arraybuffer"),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(e,(function(t){try{n(i.parse(t,a))}catch(t){o?o(t):console.error(t),i.manager.itemError(e)}}),r,o)}parse(e,n){if(function(e){const t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===tn(e,0,t.length)}(e))Rt=(new Gt).parse(e);else{const t=tn(e);if(!function(e){const t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let n=0;function r(t){const r=e[t-1];return e=e.slice(n+t),n++,r}for(let e=0;e<t.length;++e)if(r(1)===t[e])return!1;return!0}(t))throw new Error("THREE.FBXLoader: Unknown format.");if(Yt(t)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Yt(t));Rt=(new Ut).parse(t)}const r=new t.TextureLoader(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin);return new Vt(r,this.manager).parse(Rt)}}class Vt{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){jt=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),r=this.parseDeformers(),o=(new zt).parse(r);return this.parseScene(r,o,n),Nt}parseConnections(){const e=new Map;return"Connections"in Rt&&Rt.Connections.connections.forEach((function(t){const n=t[0],r=t[1],o=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const i={ID:r,relationship:o};e.get(n).parents.push(i),e.has(r)||e.set(r,{parents:[],children:[]});const a={ID:n,relationship:o};e.get(r).children.push(a)})),e}parseImages(){const e={},t={};if("Video"in Rt.Objects){const n=Rt.Objects.Video;for(const r in n){const o=n[r];if(e[parseInt(r)]=o.RelativeFilename||o.Filename,"Content"in o){const e=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,i="string"==typeof o.Content&&""!==o.Content;if(e||i){const e=this.parseImage(n[r]);t[o.RelativeFilename||o.Filename]=e}}}}for(const n in e){const r=e[n];e[n]=void 0!==t[r]?t[r]:e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();let o;switch(r){case"bmp":o="image/bmp";break;case"jpg":case"jpeg":o="image/jpeg";break;case"png":o="image/png";break;case"tif":o="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",n),o="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if("string"==typeof t)return"data:"+o+";base64,"+t;{const e=new Uint8Array(t);return window.URL.createObjectURL(new Blob([e],{type:o}))}}parseTextures(e){const t=new Map;if("Texture"in Rt.Objects){const n=Rt.Objects.Texture;for(const r in n){const o=this.parseTexture(n[r],e);t.set(parseInt(r),o)}}return t}parseTexture(e,n){const r=this.loadTexture(e,n);r.ID=e.id,r.name=e.attrName;const o=e.WrapModeU,i=e.WrapModeV,a=void 0!==i?i.value:0;if(r.wrapS=0===(void 0!==o?o.value:0)?t.RepeatWrapping:t.ClampToEdgeWrapping,r.wrapT=0===a?t.RepeatWrapping:t.ClampToEdgeWrapping,"Scaling"in e){const t=e.Scaling.value;r.repeat.x=t[0],r.repeat.y=t[1]}return r}loadTexture(e,n){let r;const o=this.textureLoader.path,i=jt.get(e.id).children;let a;void 0!==i&&i.length>0&&void 0!==n[i[0].ID]&&(r=n[i[0].ID],0!==r.indexOf("blob:")&&0!==r.indexOf("data:")||this.textureLoader.setPath(void 0));const s=e.FileName.slice(-3).toLowerCase();if("tga"===s){const n=this.manager.getHandler(".tga");null===n?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),a=new t.Texture):a=n.load(r)}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),a=new t.Texture):a=this.textureLoader.load(r);return this.textureLoader.setPath(o),a}parseMaterials(e){const t=new Map;if("Material"in Rt.Objects){const n=Rt.Objects.Material;for(const r in n){const o=this.parseMaterial(n[r],e);null!==o&&t.set(parseInt(r),o)}}return t}parseMaterial(e,n){const r=e.id,o=e.attrName;let i=e.ShadingModel;if("object"==typeof i&&(i=i.value),!jt.has(r))return null;const a=this.parseParameters(e,n,r);let s;switch(i.toLowerCase()){case"phong":s=new t.MeshPhongMaterial;break;case"lambert":s=new t.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',i),s=new t.MeshPhongMaterial}return s.setValues(a),s.name=o,s}parseParameters(e,n,r){const o={};e.BumpFactor&&(o.bumpScale=e.BumpFactor.value),e.Diffuse?o.color=(new t.Color).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(o.color=(new t.Color).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(o.displacementScale=e.DisplacementFactor.value),e.Emissive?o.emissive=(new t.Color).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(o.emissive=(new t.Color).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(o.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(o.opacity=parseFloat(e.Opacity.value)),o.opacity<1&&(o.transparent=!0),e.ReflectionFactor&&(o.reflectivity=e.ReflectionFactor.value),e.Shininess&&(o.shininess=e.Shininess.value),e.Specular?o.specular=(new t.Color).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(o.specular=(new t.Color).fromArray(e.SpecularColor.value));const i=this;return jt.get(r).children.forEach((function(e){const r=e.relationship;switch(r){case"Bump":o.bumpMap=i.getTexture(n,e.ID);break;case"Maya|TEX_ao_map":o.aoMap=i.getTexture(n,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":o.map=i.getTexture(n,e.ID),o.map.encoding=t.sRGBEncoding;break;case"DisplacementColor":o.displacementMap=i.getTexture(n,e.ID);break;case"EmissiveColor":o.emissiveMap=i.getTexture(n,e.ID),o.emissiveMap.encoding=t.sRGBEncoding;break;case"NormalMap":case"Maya|TEX_normal_map":o.normalMap=i.getTexture(n,e.ID);break;case"ReflectionColor":o.envMap=i.getTexture(n,e.ID),o.envMap.mapping=t.EquirectangularReflectionMapping,o.envMap.encoding=t.sRGBEncoding;break;case"SpecularColor":o.specularMap=i.getTexture(n,e.ID),o.specularMap.encoding=t.sRGBEncoding;break;case"TransparentColor":case"TransparencyFactor":o.alphaMap=i.getTexture(n,e.ID),o.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",r)}})),o}getTexture(e,t){return"LayeredTexture"in Rt.Objects&&t in Rt.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=jt.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Rt.Objects){const n=Rt.Objects.Deformer;for(const r in n){const o=n[r],i=jt.get(parseInt(r));if("Skin"===o.attrType){const t=this.parseSkeleton(i,n);t.ID=r,i.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=i.parents[0].ID,e[r]=t}else if("BlendShape"===o.attrType){const e={id:r};e.rawTargets=this.parseMorphTargets(i,n),e.id=r,i.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,n){const r=[];return e.children.forEach((function(e){const o=n[e.ID];if("Cluster"!==o.attrType)return;const i={ID:e.ID,indices:[],weights:[],transformLink:(new t.Matrix4).fromArray(o.TransformLink.a)};"Indexes"in o&&(i.indices=o.Indexes.a,i.weights=o.Weights.a),r.push(i)})),{rawBones:r,bones:[]}}parseMorphTargets(e,t){const n=[];for(let r=0;r<e.children.length;r++){const o=e.children[r],i=t[o.ID],a={name:i.attrName,initialWeight:i.DeformPercent,id:i.id,fullWeights:i.FullWeights.a};if("BlendShapeChannel"!==i.attrType)return;a.geoID=jt.get(parseInt(o.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,n.push(a)}return n}parseScene(e,n,r){Nt=new t.Group;const o=this.parseModels(e.skeletons,n,r),i=Rt.Objects.Model,a=this;o.forEach((function(e){a.setLookAtProperties(e,i[e.ID]),jt.get(e.ID).parents.forEach((function(t){const n=o.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&Nt.add(e)})),this.bindSkeleton(e.skeletons,n,o),this.createAmbientLight(),this.setupMorphMaterials(),Nt.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);const t=$t(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));const s=(new Bt).parse();1===Nt.children.length&&Nt.children[0].isGroup&&(Nt.children[0].animations=s,Nt=Nt.children[0]),Nt.animations=s}parseModels(e,n,r){const o=new Map,i=Rt.Objects.Model;for(const a in i){const s=parseInt(a),c=i[a],u=jt.get(s);let l=this.buildSkeleton(u,e,s,c.attrName);if(!l){switch(c.attrType){case"Camera":l=this.createCamera(u);break;case"Light":l=this.createLight(u);break;case"Mesh":l=this.createMesh(u,n,r);break;case"NurbsCurve":l=this.createCurve(u,n);break;case"LimbNode":case"Root":l=new t.Bone;break;case"Null":default:l=new t.Group}l.name=c.attrName?t.PropertyBinding.sanitizeNodeName(c.attrName):"",l.ID=s}this.getTransformData(l,c),o.set(s,l)}return o}buildSkeleton(e,n,r,o){let i=null;return e.parents.forEach((function(e){for(const a in n){const s=n[a];s.rawBones.forEach((function(n,a){if(n.ID===e.ID){const e=i;i=new t.Bone,i.matrixWorld.copy(n.transformLink),i.name=o?t.PropertyBinding.sanitizeNodeName(o):"",i.ID=r,s.bones[a]=i,null!==e&&i.add(e)}}))}})),i}createCamera(e){let n,r;if(e.children.forEach((function(e){const t=Rt.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)})),void 0===r)n=new t.Object3D;else{let e=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(e=1);let o=1;void 0!==r.NearPlane&&(o=r.NearPlane.value/1e3);let i=1e3;void 0!==r.FarPlane&&(i=r.FarPlane.value/1e3);let a=window.innerWidth,s=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(a=r.AspectWidth.value,s=r.AspectHeight.value);const c=a/s;let u=45;void 0!==r.FieldOfView&&(u=r.FieldOfView.value);const l=r.FocalLength?r.FocalLength.value:null;switch(e){case 0:n=new t.PerspectiveCamera(u,c,o,i),null!==l&&n.setFocalLength(l);break;case 1:n=new t.OrthographicCamera(-a/2,a/2,s/2,-s/2,o,i);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),n=new t.Object3D}}return n}createLight(e){let n,r;if(e.children.forEach((function(e){const t=Rt.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)})),void 0===r)n=new t.Object3D;else{let e;e=void 0===r.LightType?0:r.LightType.value;let o=16777215;void 0!==r.Color&&(o=(new t.Color).fromArray(r.Color.value));let i=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(i=0);let a=0;void 0!==r.FarAttenuationEnd&&(a=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value);const s=1;switch(e){case 0:n=new t.PointLight(o,i,a,s);break;case 1:n=new t.DirectionalLight(o,i);break;case 2:let e=Math.PI/3;void 0!==r.InnerAngle&&(e=t.MathUtils.degToRad(r.InnerAngle.value));let c=0;void 0!==r.OuterAngle&&(c=t.MathUtils.degToRad(r.OuterAngle.value),c=Math.max(c,1)),n=new t.SpotLight(o,i,a,e,c,s);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),n=new t.PointLight(o,i)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(n.castShadow=!0)}return n}createMesh(e,n,r){let o,i=null,a=null;const s=[];return e.children.forEach((function(e){n.has(e.ID)&&(i=n.get(e.ID)),r.has(e.ID)&&s.push(r.get(e.ID))})),s.length>1?a=s:s.length>0?a=s[0]:(a=new t.MeshPhongMaterial({color:13421772}),s.push(a)),"color"in i.attributes&&s.forEach((function(e){e.vertexColors=!0})),i.FBX_Deformer?(s.forEach((function(e){e.skinning=!0})),o=new t.SkinnedMesh(i,a),o.normalizeSkinWeights()):o=new t.Mesh(i,a),o}createCurve(e,n){const r=e.children.reduce((function(e,t){return n.has(t.ID)&&(e=n.get(t.ID)),e}),null),o=new t.LineBasicMaterial({color:3342591,linewidth:1});return new t.Line(r,o)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?Jt(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,n){"LookAtProperty"in n&&jt.get(e.ID).children.forEach((function(n){if("LookAtProperty"===n.relationship){const r=Rt.Objects.Model[n.ID];if("Lcl_Translation"in r){const n=r.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(n),Nt.add(e.target)):e.lookAt((new t.Vector3).fromArray(n))}}}))}bindSkeleton(e,n,r){const o=this.parsePoseNodes();for(const i in e){const a=e[i];jt.get(parseInt(a.ID)).parents.forEach((function(e){n.has(e.ID)&&jt.get(e.ID).parents.forEach((function(e){r.has(e.ID)&&r.get(e.ID).bind(new t.Skeleton(a.bones),o[e.ID])}))}))}}parsePoseNodes(){const e={};if("Pose"in Rt.Objects){const n=Rt.Objects.Pose;for(const r in n)if("BindPose"===n[r].attrType){const o=n[r].PoseNode;Array.isArray(o)?o.forEach((function(n){e[n.Node]=(new t.Matrix4).fromArray(n.Matrix.a)})):e[o.Node]=(new t.Matrix4).fromArray(o.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in Rt&&"AmbientColor"in Rt.GlobalSettings){const e=Rt.GlobalSettings.AmbientColor.value,n=e[0],r=e[1],o=e[2];if(0!==n||0!==r||0!==o){const e=new t.Color(n,r,o);Nt.add(new t.AmbientLight(e,1))}}}setupMorphMaterials(){const e=this;Nt.traverse((function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach((function(n,r){e.setupMorphMaterial(t,n,r)})):e.setupMorphMaterial(t,t.material))}))}setupMorphMaterial(e,t,n){const r=e.uuid,o=t.uuid;let i=!1;if(Nt.traverse((function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(t){t.uuid===o&&e.uuid!==r&&(i=!0)})):e.material.uuid===o&&e.uuid!==r&&(i=!0))})),!0===i){const r=t.clone();r.morphTargets=!0,void 0===n?e.material=r:e.material[n]=r}else t.morphTargets=!0}}class zt{parse(e){const t=new Map;if("Geometry"in Rt.Objects){const n=Rt.Objects.Geometry;for(const r in n){const o=jt.get(parseInt(r)),i=this.parseGeometry(o,n[r],e);t.set(parseInt(r),i)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const r=n.skeletons,o=[],i=e.parents.map((function(e){return Rt.Objects.Model[e.ID]}));if(0===i.length)return;const a=e.children.reduce((function(e,t){return void 0!==r[t.ID]&&(e=r[t.ID]),e}),null);e.children.forEach((function(e){void 0!==n.morphTargets[e.ID]&&o.push(n.morphTargets[e.ID])}));const s=i[0],c={};"RotationOrder"in s&&(c.eulerOrder=Jt(s.RotationOrder.value)),"InheritType"in s&&(c.inheritType=parseInt(s.InheritType.value)),"GeometricTranslation"in s&&(c.translation=s.GeometricTranslation.value),"GeometricRotation"in s&&(c.rotation=s.GeometricRotation.value),"GeometricScaling"in s&&(c.scale=s.GeometricScaling.value);const u=$t(c);return this.genGeometry(t,a,o,u)}genGeometry(e,n,r,o){const i=new t.BufferGeometry;e.attrName&&(i.name=e.attrName);const a=this.parseGeoNode(e,n),s=this.genBuffers(a),c=new t.Float32BufferAttribute(s.vertex,3);if(c.applyMatrix4(o),i.setAttribute("position",c),s.colors.length>0&&i.setAttribute("color",new t.Float32BufferAttribute(s.colors,3)),n&&(i.setAttribute("skinIndex",new t.Uint16BufferAttribute(s.weightsIndices,4)),i.setAttribute("skinWeight",new t.Float32BufferAttribute(s.vertexWeights,4)),i.FBX_Deformer=n),s.normal.length>0){const e=(new t.Matrix3).getNormalMatrix(o),n=new t.Float32BufferAttribute(s.normal,3);n.applyNormalMatrix(e),i.setAttribute("normal",n)}if(s.uvs.forEach((function(e,n){let r="uv"+(n+1).toString();0===n&&(r="uv"),i.setAttribute(r,new t.Float32BufferAttribute(s.uvs[n],2))})),a.material&&"AllSame"!==a.material.mappingType){let e=s.materialIndex[0],t=0;if(s.materialIndex.forEach((function(n,r){n!==e&&(i.addGroup(t,r-t,e),e=n,t=r)})),i.groups.length>0){const t=i.groups[i.groups.length-1],n=t.start+t.count;n!==s.materialIndex.length&&i.addGroup(n,s.materialIndex.length-n,e)}0===i.groups.length&&i.addGroup(0,s.materialIndex.length,s.materialIndex[0])}return this.addMorphTargets(i,e,r,o),i}parseGeoNode(e,t){const n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(r,o){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:t,weight:e.weights[o]})}))}))),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,o=!1,i=[],a=[],s=[],c=[],u=[],l=[];const h=this;return e.vertexIndices.forEach((function(p,f){let d,m=!1;p<0&&(p^=-1,m=!0);let g=[],v=[];if(i.push(3*p,3*p+1,3*p+2),e.color){const t=Kt(f,n,p,e.color);s.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[p]&&e.weightTable[p].forEach((function(e){v.push(e.weight),g.push(e.id)})),v.length>4){o||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);const e=[0,0,0,0],t=[0,0,0,0];v.forEach((function(n,r){let o=n,i=g[r];t.forEach((function(t,n,r){if(o>t){r[n]=o,o=t;const a=e[n];e[n]=i,i=a}}))})),g=e,v=t}for(;v.length<4;)v.push(0),g.push(0);for(let e=0;e<4;++e)u.push(v[e]),l.push(g[e])}if(e.normal){const t=Kt(f,n,p,e.normal);a.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(d=Kt(f,n,p,e.material)[0]),e.uv&&e.uv.forEach((function(e,t){const r=Kt(f,n,p,e);void 0===c[t]&&(c[t]=[]),c[t].push(r[0]),c[t].push(r[1])})),r++,m&&(h.genFace(t,e,i,d,a,s,c,u,l,r),n++,r=0,i=[],a=[],s=[],c=[],u=[],l=[])})),t}genFace(e,t,n,r,o,i,a,s,c,u){for(let l=2;l<u;l++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(l-1)]]),e.vertex.push(t.vertexPositions[n[3*(l-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(l-1)+2]]),e.vertex.push(t.vertexPositions[n[3*l]]),e.vertex.push(t.vertexPositions[n[3*l+1]]),e.vertex.push(t.vertexPositions[n[3*l+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(l-1)]),e.vertexWeights.push(s[4*(l-1)+1]),e.vertexWeights.push(s[4*(l-1)+2]),e.vertexWeights.push(s[4*(l-1)+3]),e.vertexWeights.push(s[4*l]),e.vertexWeights.push(s[4*l+1]),e.vertexWeights.push(s[4*l+2]),e.vertexWeights.push(s[4*l+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[4*(l-1)]),e.weightsIndices.push(c[4*(l-1)+1]),e.weightsIndices.push(c[4*(l-1)+2]),e.weightsIndices.push(c[4*(l-1)+3]),e.weightsIndices.push(c[4*l]),e.weightsIndices.push(c[4*l+1]),e.weightsIndices.push(c[4*l+2]),e.weightsIndices.push(c[4*l+3])),t.color&&(e.colors.push(i[0]),e.colors.push(i[1]),e.colors.push(i[2]),e.colors.push(i[3*(l-1)]),e.colors.push(i[3*(l-1)+1]),e.colors.push(i[3*(l-1)+2]),e.colors.push(i[3*l]),e.colors.push(i[3*l+1]),e.colors.push(i[3*l+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(o[0]),e.normal.push(o[1]),e.normal.push(o[2]),e.normal.push(o[3*(l-1)]),e.normal.push(o[3*(l-1)+1]),e.normal.push(o[3*(l-1)+2]),e.normal.push(o[3*l]),e.normal.push(o[3*l+1]),e.normal.push(o[3*l+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(a[n][0]),e.uvs[n].push(a[n][1]),e.uvs[n].push(a[n][2*(l-1)]),e.uvs[n].push(a[n][2*(l-1)+1]),e.uvs[n].push(a[n][2*l]),e.uvs[n].push(a[n][2*l+1])}))}addMorphTargets(e,t,n,r){if(0===n.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const o=this;n.forEach((function(n){n.rawTargets.forEach((function(n){const i=Rt.Objects.Geometry[n.geoID];void 0!==i&&o.genMorphGeometry(e,t,i,r,n.name)}))}))}genMorphGeometry(e,n,r,o,i){const a=void 0!==n.PolygonVertexIndex?n.PolygonVertexIndex.a:[],s=void 0!==r.Vertices?r.Vertices.a:[],c=void 0!==r.Indexes?r.Indexes.a:[],u=new Float32Array(3*e.attributes.position.count);for(let e=0;e<c.length;e++){const t=3*c[e];u[t]=s[3*e],u[t+1]=s[3*e+1],u[t+2]=s[3*e+2]}const l=this.genBuffers({vertexIndices:a,vertexPositions:u}),h=new t.Float32BufferAttribute(l.vertex,3);h.name=i||r.attrName,h.applyMatrix4(o),e.morphAttributes.position.push(h)}parseNormals(e){const t=e.ReferenceInformationType;let n=[];return"IndexToDirect"===t&&("NormalIndex"in e?n=e.NormalIndex.a:"NormalsIndex"in e&&(n=e.NormalsIndex.a)),{dataSize:3,buffer:e.Normals.a,indices:n,mappingType:e.MappingInformationType,referenceType:t}}parseUVs(e){const t=e.ReferenceInformationType;let n=[];return"IndexToDirect"===t&&(n=e.UVIndex.a),{dataSize:2,buffer:e.UV.a,indices:n,mappingType:e.MappingInformationType,referenceType:t}}parseVertexColors(e){const t=e.ReferenceInformationType;let n=[];return"IndexToDirect"===t&&(n=e.ColorIndex.a),{dataSize:4,buffer:e.Colors.a,indices:n,mappingType:e.MappingInformationType,referenceType:t}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=e.Materials.a,o=[];for(let e=0;e<r.length;++e)o.push(e);return{dataSize:1,buffer:r,indices:o,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(void 0===Ct)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new t.BufferGeometry;const n=parseInt(e.Order);if(isNaN(n))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new t.BufferGeometry;const r=n-1,o=e.KnotVector.a,i=[],a=e.Points.a;for(let e=0,n=a.length;e<n;e+=4)i.push((new t.Vector4).fromArray(a,e));let s,c;if("Closed"===e.Form)i.push(i[0]);else if("Periodic"===e.Form){s=r,c=o.length-1-s;for(let e=0;e<r;++e)i.push(i[e])}const u=new Ct(r,o,i,s,c).getPoints(7*i.length),l=new Float32Array(3*u.length);u.forEach((function(e,t){e.toArray(l,3*t)}));const h=new t.BufferGeometry;return h.setAttribute("position",new t.BufferAttribute(l,3)),h}}class Bt{parse(){const e=[],t=this.parseClips();if(void 0!==t)for(const n in t){const r=this.addClip(t[n]);e.push(r)}return e}parseClips(){if(void 0===Rt.Objects.AnimationCurve)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Rt.Objects.AnimationCurveNode,t=new Map;for(const n in e){const r=e[n];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){const e={id:r.id,attr:r.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){const t=Rt.Objects.AnimationCurve;for(const n in t){const r={id:t[n].id,times:t[n].KeyTime.a.map(Wt),values:t[n].KeyValueFloat.a},o=jt.get(r.id);if(void 0!==o){const t=o.parents[0].ID,n=o.parents[0].relationship;n.match(/X/)?e.get(t).curves.x=r:n.match(/Y/)?e.get(t).curves.y=r:n.match(/Z/)?e.get(t).curves.z=r:n.match(/d|DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=r)}}}parseAnimationLayers(e){const n=Rt.Objects.AnimationLayer,r=new Map;for(const o in n){const n=[],i=jt.get(parseInt(o));void 0!==i&&(i.children.forEach((function(r,o){if(e.has(r.ID)){const i=e.get(r.ID);if(void 0!==i.curves.x||void 0!==i.curves.y||void 0!==i.curves.z){if(void 0===n[o]){const e=jt.get(r.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==e){const i=Rt.Objects.Model[e.toString()];if(void 0===i)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",r);const a={modelName:i.attrName?t.PropertyBinding.sanitizeNodeName(i.attrName):"",ID:i.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Nt.traverse((function(e){e.ID===i.id&&(a.transform=e.matrix,e.userData.transformData&&(a.eulerOrder=e.userData.transformData.eulerOrder))})),a.transform||(a.transform=new t.Matrix4),"PreRotation"in i&&(a.preRotation=i.PreRotation.value),"PostRotation"in i&&(a.postRotation=i.PostRotation.value),n[o]=a}}n[o]&&(n[o][i.attr]=i)}else if(void 0!==i.curves.morph){if(void 0===n[o]){const e=jt.get(r.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,i=jt.get(e).parents[0].ID,a=jt.get(i).parents[0].ID,s=jt.get(a).parents[0].ID,c=Rt.Objects.Model[s],u={modelName:c.attrName?t.PropertyBinding.sanitizeNodeName(c.attrName):"",morphName:Rt.Objects.Deformer[e].attrName};n[o]=u}n[o][i.attr]=i}}})),r.set(parseInt(o),n))}return r}parseAnimStacks(e){const t=Rt.Objects.AnimationStack,n={};for(const r in t){const o=jt.get(parseInt(r)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const i=e.get(o[0].ID);n[r]={name:t[r].attrName,layer:i}}return n}addClip(e){let n=[];const r=this;return e.layer.forEach((function(e){n=n.concat(r.generateTracks(e))})),new t.AnimationClip(e.name,-1,n)}generateTracks(e){const n=[];let r=new t.Vector3,o=new t.Quaternion,i=new t.Vector3;if(e.transform&&e.transform.decompose(r,o,i),r=r.toArray(),o=(new t.Euler).setFromQuaternion(o,e.eulerOrder).toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){const t=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==t&&n.push(t)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){const t=this.generateRotationTrack(e.modelName,e.R.curves,o,e.preRotation,e.postRotation,e.eulerOrder);void 0!==t&&n.push(t)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){const t=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==t&&n.push(t)}if(void 0!==e.DeformPercent){const t=this.generateMorphTrack(e);void 0!==t&&n.push(t)}return n}generateVectorTrack(e,n,r,o){const i=this.getTimesForAllAxes(n),a=this.getKeyframeTrackValues(i,n,r);return new t.VectorKeyframeTrack(e+"."+o,i,a)}generateRotationTrack(e,n,r,o,i,a){void 0!==n.x&&(this.interpolateRotations(n.x),n.x.values=n.x.values.map(t.MathUtils.degToRad)),void 0!==n.y&&(this.interpolateRotations(n.y),n.y.values=n.y.values.map(t.MathUtils.degToRad)),void 0!==n.z&&(this.interpolateRotations(n.z),n.z.values=n.z.values.map(t.MathUtils.degToRad));const s=this.getTimesForAllAxes(n),c=this.getKeyframeTrackValues(s,n,r);void 0!==o&&((o=o.map(t.MathUtils.degToRad)).push(a),o=(new t.Euler).fromArray(o),o=(new t.Quaternion).setFromEuler(o)),void 0!==i&&((i=i.map(t.MathUtils.degToRad)).push(a),i=(new t.Euler).fromArray(i),i=(new t.Quaternion).setFromEuler(i).invert());const u=new t.Quaternion,l=new t.Euler,h=[];for(let e=0;e<c.length;e+=3)l.set(c[e],c[e+1],c[e+2],a),u.setFromEuler(l),void 0!==o&&u.premultiply(o),void 0!==i&&u.multiply(i),u.toArray(h,e/3*4);return new t.QuaternionKeyframeTrack(e+".quaternion",s,h)}generateMorphTrack(e){const n=e.DeformPercent.curves.morph,r=n.values.map((function(e){return e/100})),o=Nt.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new t.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+o+"]",n.times,r)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})),t.length>1){let e=1,n=t[0];for(let r=1;r<t.length;r++){const o=t[r];o!==n&&(t[e]=o,n=o,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,n){const r=n,o=[];let i=-1,a=-1,s=-1;return e.forEach((function(e){if(t.x&&(i=t.x.times.indexOf(e)),t.y&&(a=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==i){const e=t.x.values[i];o.push(e),r[0]=e}else o.push(r[0]);if(-1!==a){const e=t.y.values[a];o.push(e),r[1]=e}else o.push(r[1]);if(-1!==s){const e=t.z.values[s];o.push(e),r[2]=e}else o.push(r[2])})),o}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],r=e.values[t]-n,o=Math.abs(r);if(o>=180){const i=o/180,a=r/i;let s=n+a;const c=e.times[t-1],u=(e.times[t]-c)/i;let l=c+u;const h=[],p=[];for(;l<e.times[t];)h.push(l),l+=u,p.push(s),s+=a;e.times=nn(e.times,t,h),e.values=nn(e.values,t,p)}}}}class Ut{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new Xt,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,r){const o=e.match(/^[\s\t]*;/),i=e.match(/^[\s\t]*$/);if(o||i)return;const a=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=e.match("^\\t{"+(t.currentIndent-1)+"}}");a?t.parseNodeBegin(e,a):s?t.parseNodeProperty(e,s,n[++r]):c?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)})),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),o={name:n},i=this.parseNodeAttr(r),a=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,o):n in a?("PoseNode"===n?a.PoseNode.push(o):void 0!==a[n].id&&(a[n]={},a[n][a[n].id]=a[n]),""!==i.id&&(a[n][i.id]=o)):"number"==typeof i.id?(a[n]={},a[n][i.id]=o):"Properties70"!==n&&(a[n]="PoseNode"===n?[o]:o),"number"==typeof i.id&&(o.id=i.id),""!==i.name&&(o.attrName=i.name),""!==i.type&&(o.attrType=i.type),this.pushStack(o)}parseNodeAttr(e){let t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}parseNodeProperty(e,t,n){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),o=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===o&&(o=n.replace(/"/g,"").replace(/,$/,"").trim());const i=this.getCurrentNode();if("Properties70"!==i.name){if("C"===r){const e=o.split(",").slice(1),t=parseInt(e[0]),n=parseInt(e[1]);let a=o.split(",").slice(3);a=a.map((function(e){return e.trim().replace(/^"/,"")})),r="connections",o=[t,n],function(e,t){for(let n=0,r=e.length,o=t.length;n<o;n++,r++)e[r]=t[n]}(o,a),void 0===i[r]&&(i[r]=[])}"Node"===r&&(i.id=o),r in i&&Array.isArray(i[r])?i[r].push(o):"a"!==r?i[r]=o:i.a=o,this.setCurrentProp(i,r),"a"===r&&","!==o.slice(-1)&&(i.a=en(o))}else this.parseNodeSpecialProperty(e,r,o)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=en(t.a))}parseNodeSpecialProperty(e,t,n){const r=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),o=r[0],i=r[1],a=r[2],s=r[3];let c=r[4];switch(i){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=en(c)}this.getPrevNode()[o]={type:i,type2:a,flag:s,value:c},this.setCurrentProp(this.getPrevNode(),o)}}class Gt{parse(e){const t=new Ht(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new Xt;for(;!this.endOfContent(t);){const e=this.parseNode(t,n);null!==e&&r.add(e.name,e)}return r}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},r=t>=7500?e.getUint64():e.getUint32(),o=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const i=e.getUint8(),a=e.getString(i);if(0===r)return null;const s=[];for(let t=0;t<o;t++)s.push(this.parseProperty(e));const c=s.length>0?s[0]:"",u=s.length>1?s[1]:"",l=s.length>2?s[2]:"";for(n.singleProperty=1===o&&e.getOffset()===r;r>e.getOffset();){const r=this.parseNode(e,t);null!==r&&this.parseSubNode(a,n,r)}return n.propertyList=s,"number"==typeof c&&(n.id=c),""!==u&&(n.attrName=u),""!==l&&(n.attrType=l),""!==a&&(n.name=a),n}parseSubNode(e,t,n){if(!0===n.singleProperty){const e=n.propertyList[0];Array.isArray(e)?(t[n.name]=n,n.a=e):t[n.name]=e}else if("Connections"===e&&"C"===n.name){const e=[];n.propertyList.forEach((function(t,n){0!==n&&e.push(t)})),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===n.name)Object.keys(n).forEach((function(e){t[e]=n[e]}));else if("Properties70"===e&&"P"===n.name){let e=n.propertyList[0],r=n.propertyList[1];const o=n.propertyList[2],i=n.propertyList[3];let a;0===e.indexOf("Lcl ")&&(e=e.replace("Lcl ","Lcl_")),0===r.indexOf("Lcl ")&&(r=r.replace("Lcl ","Lcl_")),a="Color"===r||"ColorRGB"===r||"Vector"===r||"Vector3D"===r||0===r.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[e]={type:r,type2:o,flag:i,value:a}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),o=e.getUint32(),i=e.getUint32();if(0===o)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}void 0===Ot&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const a=it(new Uint8Array(e.getArrayBuffer(i))),s=new Ht(a.buffer);switch(t){case"b":case"c":return s.getBooleanArray(r);case"d":return s.getFloat64Array(r);case"f":return s.getFloat32Array(r);case"i":return s.getInt32Array(r);case"l":return s.getInt64Array(r)}default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Ht{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,4294967295===e&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let n=[];for(let t=0;t<e;t++)n[t]=this.getUint8();const r=n.indexOf(0);return r>=0&&(n=n.slice(0,r)),t.LoaderUtils.decodeText(new Uint8Array(n))}}class Xt{add(e,t){this[e]=t}}function Yt(e){const t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Wt(e){return e/46186158e3}const Zt=[];function Kt(e,t,n,r){let o;switch(r.mappingType){case"ByPolygonVertex":o=e;break;case"ByPolygon":o=t;break;case"ByVertice":o=n;break;case"AllSame":o=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(o=r.indices[o]);const i=o*r.dataSize;return function(e,t,n,r){for(let o=n,i=0;o<r;o++,i++)e[i]=t[o];return e}(Zt,r.buffer,i,i+r.dataSize)}const qt=new t.Euler,Qt=new t.Vector3;function $t(e){const n=new t.Matrix4,r=new t.Matrix4,o=new t.Matrix4,i=new t.Matrix4,a=new t.Matrix4,s=new t.Matrix4,c=new t.Matrix4,u=new t.Matrix4,l=new t.Matrix4,h=new t.Matrix4,p=new t.Matrix4,f=new t.Matrix4,d=e.inheritType?e.inheritType:0;if(e.translation&&n.setPosition(Qt.fromArray(e.translation)),e.preRotation){const n=e.preRotation.map(t.MathUtils.degToRad);n.push(e.eulerOrder),r.makeRotationFromEuler(qt.fromArray(n))}if(e.rotation){const n=e.rotation.map(t.MathUtils.degToRad);n.push(e.eulerOrder),o.makeRotationFromEuler(qt.fromArray(n))}if(e.postRotation){const n=e.postRotation.map(t.MathUtils.degToRad);n.push(e.eulerOrder),i.makeRotationFromEuler(qt.fromArray(n)),i.invert()}e.scale&&a.scale(Qt.fromArray(e.scale)),e.scalingOffset&&c.setPosition(Qt.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(Qt.fromArray(e.scalingPivot)),e.rotationOffset&&u.setPosition(Qt.fromArray(e.rotationOffset)),e.rotationPivot&&l.setPosition(Qt.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(p.copy(e.parentMatrix),h.copy(e.parentMatrixWorld));const m=(new t.Matrix4).copy(r).multiply(o).multiply(i),g=new t.Matrix4;g.extractRotation(h);const v=new t.Matrix4;v.copyPosition(h);const y=new t.Matrix4,w=(new t.Matrix4).copy(v).invert().multiply(h);y.copy(g).invert().multiply(w);const b=a,E=new t.Matrix4;if(0===d)E.copy(g).multiply(m).multiply(y).multiply(b);else if(1===d)E.copy(g).multiply(y).multiply(m).multiply(b);else{const e=(new t.Matrix4).scale((new t.Vector3).setFromMatrixScale(p)),n=(new t.Matrix4).copy(e).invert(),r=(new t.Matrix4).copy(y).multiply(n);E.copy(g).multiply(m).multiply(r).multiply(b)}const _=new t.Matrix4;_.copy(l).invert();const x=new t.Matrix4;x.copy(s).invert();let T=new t.Matrix4;T.copy(n).multiply(u).multiply(l).multiply(r).multiply(o).multiply(i).multiply(_).multiply(c).multiply(s).multiply(a).multiply(x);const k=(new t.Matrix4).copyPosition(T),L=(new t.Matrix4).copy(h).multiply(k);return f.copyPosition(L),T=(new t.Matrix4).copy(f).multiply(E),T.premultiply(h.invert()),T}function Jt(e){const t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function en(e){return e.split(",").map((function(e){return parseFloat(e)}))}function tn(e,n,r){return void 0===n&&(n=0),void 0===r&&(r=e.byteLength),t.LoaderUtils.decodeText(new Uint8Array(e,n,r))}function nn(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}var rn=function(){var e=this;this._sceneEntityGroup=new t.Group,this.getSceneEntityGroup=function(){return e._sceneEntityGroup}},on=function(e){function n(){var t;return(t=e.apply(this,arguments)||this).update=function(e){t._sceneEntityGroup.rotateY(0*e+.001)},t}return a(n,e),n.prototype.init=function(){var e=o(s.mark((function e(){var n=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var r;r=function(r){n._sceneEntityGroup.add(r),n._sceneEntityGroup.rotateX(Math.PI/2);var o=new t.BoxHelper(r,16776960);o.userData.isHelper=!0,n._sceneEntityGroup.add(o);var i=new t.Mesh(new t.SphereGeometry(1),new t.MeshPhongMaterial({color:"white",opacity:.5}));i.userData.isHelper=!0,n._sceneEntityGroup.add(i),r.traverse((function(e){e.visible=!0;var r=new t.BoxHelper(e,16776960);r.userData.isHelper=!0,n._sceneEntityGroup.add(r)})),e(n._sceneEntityGroup)},(new Ft).load("https://d-w-d.github.io/tsdx-threejs-react-boilerplate/images/low-poly-well.fbx",(function(e){(function(e,n){var r=Math.pow(10,-10);e.traverse((function(e){e instanceof t.Mesh&&(e.geometry.computeBoundingSphere(),e.geometry&&e.geometry.boundingSphere&&e.geometry.boundingSphere.radius>r&&(r=e.geometry.boundingSphere.radius))}));var o=.05/r;e.scale.set(o,o,o)})(e),function(e){var n=(new t.Box3).setFromObject(e).getCenter(new t.Vector3).toArray(),r=n[0],o=n[1],i=n[2],a=e.position.clone().toArray();e.position.set(a[0]-r,a[1]-o,a[2]-i)}(e),function(e){e.traverse((function(e){"Mesh"===e.type&&(e.castShadow=!0,e.receiveShadow=!0)}))}(e),r(e)}),(function(e){console.log(e.loaded/e.total*100+"% loaded")}),(function(e){console.log("Loading error occurred:",e.message)}))})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),n}(rn),an=function(e){function n(){var t;return(t=e.apply(this,arguments)||this).update=function(e){t._sceneEntityGroup.position.x+=0*e},t}return a(n,e),n.prototype.init=function(){var e=o(s.mark((function e(){var n=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var r=new t.AxesHelper(500);r.userData.isHelper=!0,n._sceneEntityGroup.add(r),e(n._sceneEntityGroup)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),n}(rn),sn=function(e){function n(){var t;return(t=e.apply(this,arguments)||this).update=function(e){t._sceneEntityGroup.position.x+=0*e},t}return a(n,e),n.prototype.init=function(){var e=o(s.mark((function e(){var n=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){console.log(">>>>",t);var r=new t.AmbientLight(3355443,.3);r.userData.isAmbientLight=!0,n._sceneEntityGroup.add(r),e(n._sceneEntityGroup)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),n}(rn),cn=function(e){function n(t){var n;return(n=e.call(this)||this).sideLength=t,n.update=function(e){n._sceneEntityGroup.position.x+=0*e},n}return a(n,e),n.prototype.init=function(){var e=o(s.mark((function e(){var n=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){n._sceneEntityGroup.add(new t.Mesh(new t.BoxGeometry(n.sideLength,n.sideLength,n.sideLength),new t.MeshPhongMaterial)),n._sceneEntityGroup.position.z=-10,e(n._sceneEntityGroup)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),n}(rn),un=function(e){function n(){var t;return(t=e.apply(this,arguments)||this).update=function(e){t._sceneEntityGroup.position.x+=0*e},t}return a(n,e),n.prototype.init=function(){var e=o(s.mark((function e(){var n=this;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var r=new t.DirectionalLight(16777215,1);r.position.set(10,10,10),r.lookAt(0,0,0),r.castShadow=!0,n._sceneEntityGroup.add(r);var o=new t.DirectionalLightHelper(r,5);o.userData.isHelper=!0,n._sceneEntityGroup.add(r),n._sceneEntityGroup.add(o),e(n._sceneEntityGroup)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),n}(rn),ln=function(e){function n(n){var r;return(r=e.call(this,n)||this).isRotating=!1,r.updateCamera=function(e){if(r.isRotating){var n=10*Math.sin(.5*e)+0,o=10*Math.cos(.5*e*2+Math.PI)+0,i=10*Math.sin(.5*e+.5*Math.PI)+0;r._camera.position.x=n,r._camera.position.y=o,r._camera.position.z=i;var a=new t.Vector3(0,0,-1);a.applyQuaternion(r._camera.quaternion),r._camera.up.copy(a),r._camera.lookAt(0,0,0)}},r.toggleRotation=function(){r.isRotating=!r.isRotating,r.isRotating?r._orbitControls.enabled=!1:(r._camera.position.copy(r._initialViewingVector),r._camera.up.copy(new t.Vector3(0,0,1)),r._orbitControls.enabled=!0)},r.addSceneEntities([new on,new an,new sn,new cn(1),new un]),r.preInitHook=function(){},r.postInitHook=function(){},r._initialViewingVector=new t.Vector3(6,15,9),r}return a(n,e),n}(v);function hn(e){if(void 0===e&&(e="threejs-canvas-container"),!document.getElementById(e))throw new Error("Can't find div of id "+e);new ln(e).init()}e.TsdxThreejsTemplate=function(e){var t=i({width:"100%",height:"100%",backgroundColor:"grey"},e),r=t.width,o=t.height,a=t.backgroundColor,s="this-id-will-never-be-duplicated-says-007";return n.useEffect((function(){return hn(s),function(){console.log("Widget app removed!!!")}}),[]),n.createElement("div",{id:s,style:{width:r,height:o,backgroundColor:a}})},e.init=hn,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=tsdxthreejstemplate.umd.production.min.js.map
